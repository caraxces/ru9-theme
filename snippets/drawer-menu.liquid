{%- assign animation_row = 1 -%}
{%- assign drawer_position = 'left' -%}
{% if logo_alignment == 'center' %}
  {%- assign drawer_position = 'right' -%}
{% endif %}

{% if enable_slide_mobile %}
  {{ 'custom.css' | asset_url | stylesheet_tag: preload: true }}
{% endif %}

<div id="NavDrawer" class="drawer drawer--right">
  <div class="drawer__contents">
    <div class="drawer__fixed-header">
      <div class="drawer__header appear-animation appear-delay-{{ animation_row }}">
        <div class="h2 drawer__title"></div>
        <div class="drawer__close">
          <!-- Mobile header layout similar to header.liquid -->
          <div class="header-layout--mobile">
            <div class="header-item--left">
              <button
                type="button"
                class="site-nav__link site-nav__link--icon js-drawer-close"
                aria-controls="NavDrawer"
              >
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none">
                  <path d="M13 1L1 13" stroke="#25282B" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M1 1L13 13" stroke="#25282B" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span class="icon__fallback-text">{{ 'general.drawers.close_menu' | t }}</span>
              </button>
              {%- if settings.search_enable -%}
                <a
                  href="{{ routes.search_url }}"
                  class="site-nav__link site-nav__link--icon js-search-header"
                  rel="nofollow"
                >
                  {% render 'icon-search' %}
                  <span class="icon__text visually-hidden">{{ 'general.search.title' | t }}</span>
                </a>
              {%- endif -%}
            </div>
            <div class="header-item header-item--logo">
              {%- render 'header-logo-block', section: section -%}
            </div>
            <div class="header-item header-item--icons">
               {%- render 'header-icons', section: section, mobile: true -%}
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="drawer__scrollable">
      <ul
        class="mobile-nav{% if settings.type_navigation_style == 'heading' %} mobile-nav--heading-style{% endif %}"
        role="navigation"
        aria-label="Primary"
      >
        {%- for link in main_menu.links -%}
          {%- assign animation_row = animation_row | plus: 1 -%}
          {%- assign child_list_handle = link.url | handleize | append: forloop.index -%}
          {%- assign has_dropdown = false -%}
          {%- assign has_slide = false -%}
          {%- if link.links != blank and enable_dropdown_mobile -%}
            {%- assign has_dropdown = true -%}
          {%- endif -%}
          {%- if link.links != blank and enable_slide_mobile -%}
            {%- assign has_slide = true -%}
          {%- endif -%}

          {% liquid
            assign active_sale_lv1 = section.settings.active_sale_lv1 | escape | downcase | split: ',' | strip | handle

            assign select_title_first_lv1 = section.settings.select_title_first_lv1 | escape | downcase | split: ',' | strip | handle
            assign text_on_label_1 = section.settings.text_on_label_1

            assign select_title_second_lv1 = section.settings.select_title_second_lv1 | escape | downcase | split: ',' | strip | handle
            assign text_on_label_2 = section.settings.text_on_label_2

            assign select_title_thrid_lv1 = section.settings.select_title_thrid_lv1 | escape | downcase | split: ',' | strip | handle
            assign text_on_label_3 = section.settings.text_on_label_3

            assign title = link.title | escape | downcase | split: ',' | strip | handle

            assign postion_custom_1 = section.settings.postion_custom_1 | escape | downcase | split: ',' | strip | handle
            assign image_1 = section.settings.image_1
            assign postion_custom_2 = section.settings.postion_custom_2 | escape | downcase | split: ',' | strip | handle
            assign image_2 = section.settings.image_2
          %}

          <li class="mobile-nav__item {% if enable_slide_mobile == false %} appear-animation appear-delay-{{ animation_row }} {% endif %}">
            {%- if has_dropdown or has_slide -%}
              <div class="mobile-nav__has-sublist">
                {%- if link.url == '#' -%}
                  <button
                    type="button"
                    aria-controls="Linklist-{{ child_list_handle }}"
                    {% if link.active or link.child_active %}
                      aria-open="true"
                    {% endif %}
                    class="mobile-nav__link--button mobile-nav__link--top-level collapsible-trigger collapsible--auto-height flex ai-center gap-x-sm{% if link.active or link.child_active %} is-open{% endif %}{% if active_sale_lv1 contains title %} is-sale{% endif %}"
                  >
                    {%- if link.object.featured_media and section.settings.dropdown_menu_images_mobile -%}
                      <div class="aspect-ratio shrink-0" style="--width:1;--height:1">
                        {%- render 'image-element',
                          img: link.object.featured_media,
                          sizeVariable: '80px',
                          alt: link.title,
                          classes: 'mobile-nav__item-image block rounded-sm'
                        -%}
                      </div>
                    {%- endif -%}
                    <span
                      class="mobile-nav__faux-link"
                      {% if link.active %}
                        data-active="true"
                      {% endif %}
                    >
                      <span class="txt text-lg f-smb">{{ link.title }}</span>
                    </span>
                    <div class="mobile-nav__toggle">
                      <span class="faux-button">
                        {%- render 'collapsible-icons' -%}
                      </span>
                    </div>
                  </button>
                {%- else -%}
                  <a
                    href="{{ link.url }}"
                    class="mobile-nav__link mobile-nav__link--top-level flex ai-center gap-x-sm{% if active_sale_lv1 contains title %} is-sale{% endif %}"
                    id="Label-{{ child_list_handle }}"
                    style="{% if active_sale_lv1 contains title %}--active-sale-clr: {{ section.settings.color_active_sale.rgb }};{% endif %}"
                    {% if link.active %}
                      data-active="true"
                    {% endif %}
                  >
                    {%- assign image_link = link.object.image | default: link.object.featured_media -%}

                    {%- if image_link and section.settings.dropdown_menu_images_mobile -%}
                      <div class="aspect-ratio shrink-0" style="--width:1;--height:1">
                        {%- render 'image-element',
                          img: image_link,
                          sizeVariable: '80px',
                          alt: link.title,
                          classes: 'mobile-nav__item-image block rounded-sm'
                        -%}
                      </div>
                    {%- endif -%}
                    {%- if postion_custom_1 contains title -%}
                      <div class="aspect-ratio shrink-0" style="--width:1;--height:1">
                        {%- render 'image-element',
                          img: image_1,
                          sizeVariable: '80px',
                          alt: link.title,
                          classes: 'mobile-nav__item-image block rounded-sm'
                        -%}
                      </div>
                    {%- elsif postion_custom_2 contains title -%}
                      <div class="aspect-ratio shrink-0" style="--width:1;--height:1">
                        {%- render 'image-element',
                          img: image_2,
                          sizeVariable: '80px',
                          alt: link.title,
                          classes: 'mobile-nav__item-image block rounded-sm'
                        -%}
                      </div>
                    {%- endif -%}
                    <span class="txt text-lg f-smb">{{ link.title }}</span>
                    {%- if select_title_first_lv1 contains title -%}
                      <span
                        class="badge-label text-xs leading-none"
                        style="--clr-on-label: {{ section.settings.color_label_1.rgb }}; --bg-on-label: {{ section.settings.background_label_1 }};"
                      >
                        {{- text_on_label_1 -}}
                      </span>
                    {%- elsif select_title_second_lv1 contains title -%}
                      <span
                        class="badge-label text-xs leading-none"
                        style="--clr-on-label: {{ section.settings.color_label_2.rgb }}; --bg-on-label: {{ section.settings.background_label_2 }};"
                      >
                        {{- text_on_label_2 -}}
                      </span>
                    {%- elsif select_title_thrid_lv1 contains title -%}
                      <span
                        class="badge-label text-xs leading-none"
                        style="--clr-on-label: {{ section.settings.color_label_3.rgb }}; --bg-on-label: {{ section.settings.background_label_3 }};"
                      >
                        {{- text_on_label_3 -}}
                      </span>
                    {%- endif -%}
                  </a>
                  <div class="mobile-nav__toggle">
                    <button
                      type="button"
                      aria-controls="Linklist-{{ child_list_handle }}"
                      {% if link.active or link.child_active %}
                        aria-open="true"
                      {% endif %}
                      aria-labelledby="Label-{{ child_list_handle }}"
                      class="collapsible-trigger collapsible--auto-height{% if link.active or link.child_active %} is-open{% endif %}"
                    >
                      {% if has_slide %}
                        <svg class="slide-trigger" viewBox="0 0 100 100">
                          <path d="M 10,50 L 60,100 L 70,90 L 30,50  L 70,10 L 60,0 Z" fill="currentColor" transform="translate(100, 100) rotate(0deg) "></path>
                        </svg>
                      {% else %}
                        {%- render 'collapsible-icons' -%}
                      {% endif %}
                    </button>
                  </div>
                {%- endif -%}
              </div>
            {%- else -%}
              <a
                href="{{ link.url }}"
                class="mobile-nav__link mobile-nav__link--top-level flex ai-center gap-x-sm{% if active_sale_lv1 contains title %} is-sale{% endif %}"
                style="{% if active_sale_lv1 contains title %}--active-sale-clr: {{ section.settings.color_active_sale.rgb }};{% endif %}"
                {% if link.active %}
                  data-active="true"
                {% endif %}
              >
                {%- assign image_link = link.object.image | default: link.object.featured_media -%}

                {%- if image_link and section.settings.dropdown_menu_images_mobile -%}
                  <div class="aspect-ratio shrink-0" style="--width:1;--height:1">
                    {%- render 'image-element',
                      img: image_link,
                      sizeVariable: '80px',
                      alt: link.title,
                      classes: 'mobile-nav__item-image block rounded-sm'
                    -%}
                  </div>
                {%- endif -%}
                {%- if postion_custom_1 contains title -%}
                  <div class="aspect-ratio shrink-0" style="--width:1;--height:1">
                    {%- render 'image-element',
                      img: image_1,
                      sizeVariable: '80px',
                      alt: link.title,
                      classes: 'mobile-nav__item-image block rounded-sm'
                    -%}
                  </div>
                {%- elsif postion_custom_2 contains title -%}
                  <div class="aspect-ratio shrink-0" style="--width:1;--height:1">
                    {%- render 'image-element',
                      img: image_2,
                      sizeVariable: '80px',
                      alt: link.title,
                      classes: 'mobile-nav__item-image block rounded-sm'
                    -%}
                  </div>
                {%- endif -%}
                <span class="txt text-lg f-smb">{{ link.title }}</span>
                {%- if select_title_first_lv1 contains title -%}
                  <span
                    class="badge-label text-xs leading-none"
                    style="--clr-on-label: {{ section.settings.color_label_1.rgb }}; --bg-on-label: {{ section.settings.background_label_1 }};"
                  >
                    {{- text_on_label_1 -}}
                  </span>
                {%- elsif select_title_second_lv1 contains title -%}
                  <span
                    class="badge-label text-xs leading-none"
                    style="--clr-on-label: {{ section.settings.color_label_2.rgb }}; --bg-on-label: {{ section.settings.background_label_2 }};"
                  >
                    {{- text_on_label_2 -}}
                  </span>
                {%- elsif select_title_thrid_lv1 contains title -%}
                  <span
                    class="badge-label text-xs leading-none"
                    style="--clr-on-label: {{ section.settings.color_label_3.rgb }}; --bg-on-label: {{ section.settings.background_label_3 }};"
                  >
                    {{- text_on_label_3 -}}
                  </span>
                {%- endif -%}
              </a>
            {%- endif -%}

            {%- if has_dropdown or has_slide -%}
              {% if has_slide %}
                <div
                  id="Linklist-{{ child_list_handle }}"
                  class="mobile-nav__sublist"
                >
                  <div class="page-width">
                    <div class="megamenu__content">
                      <div class="megamenu__col appear-animation appear-delay-{{ animation_column }}">
                        {%- assign animation_column = animation_column | plus: 1 -%}
                        <div class="megamenu__grandchild-header">
                          <div class="h5">
                            <button type="button" class="megamenu__close-button js-megamenu-close">
                              <svg class="icon icon-close" viewBox="0 0 100 100">
                                <path d="M 10,50 L 60,100 L 70,90 L 30,50  L 70,10 L 60,0 Z" fill="currentColor" transform="translate(100, 100) rotate(0deg) "></path>
                              </svg>

                              <span class="icon__fallback-text">{{ 'general.drawers.close_menu' | t }}</span>
                            </button>
                            <a
                              href="{{ link.url }}"
                              class="site-nav__dropdown-link site-nav__dropdown-link--top-level js-megamenu-close "
                            >
                              {{- link.title -}}
                            </a>
                          </div>
                          <div class="drawer__close">
                            <button type="button" class="drawer__close-button js-drawer-close">
                              {%- render 'close-icon' -%}
                              <span class="icon__fallback-text">{{ 'general.drawers.close_menu' | t }}</span>
                            </button>
                          </div>
                        </div>

                        {%- for childlink in link.links -%}
                          <div class="megamenu__grandchild-list">
                            <div class="flex jc-between ai-center" style="margin-bottom: 10px;">
                              <a
                                href="{{ childlink.url }}"
                                class="site-nav__dropdown-link site-nav__dropdown-link--top-level js-megamenu-close"
                                style="padding: 5px; font-weight: bold;"
                              >
                                {{- childlink.title -}}
                              </a>
                              <a href="{{ childlink.url }}" class="show-more-btn text-sm">
                                {{ 'general.menu.show_more_btn' | t }}
                              </a>
                            </div>
                            {%- for grandchildlink in childlink.links -%}
                              <div class="megamenu__grandchild-item">
                                <a href="{{ grandchildlink.url }}" class="site-nav__dropdown-link">
                                  <div class="aspect-ratio" style="--width:1;--height:1">
                                    {% if grandchildlink.object.metafields.custom.menu_image -%}
                                      <img
                                        loading="lazy"
                                        src="{{ grandchildlink.object.metafields.custom.menu_image  | file_url}}"
                                        alt="{{ grandchildlink.title }}"
                                        width="auto"
                                        height="auto"
                                      >

                                    {% else %}
                                      <img
                                        loading="lazy"
                                        src="{{ grandchildlink.object.featured_media  | img_url : '320x'}}"
                                        alt="{{ grandchildlink.title }}"
                                        width="auto"
                                        height="auto"
                                      >
                                    {% endif %}
                                  </div>
                                  <span class="megamenu__grandchild-title">{{ grandchildlink.title }}</span>
                                </a>
                              </div>
                            {%- endfor -%}
                          </div>
                        {%- endfor -%}

                        {% comment %} <a href="{{ link.url }}" class="btn btn-primary">
                          {{ 'general.menu.show_more_btn' | t }}
                        </a> {% endcomment %}
                      </div>
                    </div>
                    <div class="megamenu__banner">
                      {% assign index = forloop.index %}

                      {% for block in section.blocks %}
                        {% assign position = block.settings.position | plus: 0 %}
                        {% if block.type == 'menu_banner' and position == index %}
                          <a href="{{block.settings.url}}">
                            <div class="aspect-ratio">
                              <img
                                src="{{block.settings.image | img_url: 'master'}}"
                                loading="lazy"
                                alt="{{block.settings.image.alt}}"
                                width="auto"
                                height="auto"
                              >
                            </div>
                            {{ block.settings.title }}
                          </a>
                        {% endif %}
                      {% endfor %}
                    </div>
                  </div>
                </div>
              {% else %}
                <div
                  id="Linklist-{{ child_list_handle }}"
                  class="mobile-nav__sublist collapsible-content collapsible-content--all{% if link.active or link.child_active %} is-open{% endif %}"
                  {% if link.active or link.child_active %}
                    style="height: auto;"
                  {% endif %}
                >
                  <div class="collapsible-content__inner">
                    <ul class="mobile-nav__sublist">
                      {%- for childlink in link.links -%}
                        {%- assign has_sub_dropdown = false -%}
                        {%- assign grand_child_list_handle = childlink.url | handleize | append: forloop.index -%}
                        {%- if childlink.links != blank -%}
                          {%- assign has_sub_dropdown = true -%}
                        {%- endif -%}

                        <li class="mobile-nav__item">
                          <div class="mobile-nav__child-item">
                            {%- if childlink.url == '#' and has_sub_dropdown -%}
                              <button
                                type="button"
                                aria-controls="Sublinklist-{{ child_list_handle }}-{{ grand_child_list_handle }}"
                                {% if childlink.active or childlink.child_active %}
                                  aria-open="true"
                                {% endif %}
                                class="mobile-nav__link--button collapsible-trigger{% if childlink.active or childlink.child_active %} is-open{% endif %}"
                              >
                                <span
                                  class="mobile-nav__faux-link"
                                  {% if childlink.active %}
                                    data-active="true"
                                  {% endif %}
                                >
                                  {{- childlink.title | escape -}}
                                </span>
                                {%- render 'collapsible-icons-alt' -%}
                              </button>
                            {%- else -%}
                              <a
                                href="{{ childlink.url }}"
                                class="mobile-nav__link"
                                id="Sublabel-{{ grand_child_list_handle }}"
                                {% if childlink.active %}
                                  data-active="true"
                                {% endif %}
                              >
                                {{ childlink.title | escape }}
                              </a>
                            {%- endif -%}
                            {%- if childlink.url != '#' and has_sub_dropdown -%}
                              <button
                                type="button"
                                aria-controls="Sublinklist-{{ child_list_handle }}-{{ grand_child_list_handle }}"
                                aria-labelledby="Sublabel-{{ grand_child_list_handle }}"
                                class="collapsible-trigger{% if childlink.active or childlink.child_active %} is-open{% endif %}"
                              >
                                {%- render 'collapsible-icons-alt' -%}
                              </button>
                            {%- endif -%}
                          </div>

                          {%- if has_sub_dropdown -%}
                            <div
                              id="Sublinklist-{{ child_list_handle }}-{{ grand_child_list_handle }}"
                              aria-labelledby="Sublabel-{{ grand_child_list_handle }}"
                              class="mobile-nav__sublist collapsible-content collapsible-content--all{% if childlink.active or childlink.child_active %} is-open{% endif %}"
                              {% if childlink.active or childlink.child_active %}
                                style="height: auto;"
                              {% endif %}
                            >
                              <div class="collapsible-content__inner">
                                <ul class="mobile-nav__grandchildlist">
                                  {%- for grandchildlink in childlink.links -%}
                                    <li class="mobile-nav__item">
                                      <a
                                        href="{{ grandchildlink.url }}"
                                        class="mobile-nav__link"
                                        {% if grandchildlink.active %}
                                          data-active="true"
                                        {% endif %}
                                      >
                                        {{ grandchildlink.title }}
                                      </a>
                                    </li>
                                  {%- endfor -%}
                                </ul>
                              </div>
                            </div>
                          {%- endif -%}
                        </li>
                      {%- endfor -%}
                    </ul>
                  </div>
                </div>
              {% endif %}
            {%- endif -%}
          </li>
        {%- endfor -%}


      </ul>
          </div>

    <!-- Bottom section with 3 components in a row - moved outside drawer__scrollable -->
    <div class="mobile-drawer-bottom flex ai-center jc-between">
      <!-- Left side: Language selector -->
      {% if section.settings.show_lang %}
        <div class="mobile-lang">
          {%- render 'multi-selectors', locale_selector: section.settings.show_lang, location: 'nav-drawer' -%}
        </div>
      {% endif %}

      <!-- Right side: Grouped menus (About + Showroom) -->
      <div class="mobile-toolbar-menus-group">
        <!-- Center: About menu with dropdown -->
        {%- if section.settings.toolbar_menu_1 != blank -%}
          <div class="mobile-toolbar-menu mobile-toolbar-menu--center" style="position: relative;">
            <a href="#" class="mobile-toolbar-trigger" style="display: flex; align-items: center; text-decoration: none; color: inherit; font-weight: 500; padding: 8px 12px; border-radius: 4px; transition: background-color 0.2s ease;">
              <span>About</span>
              <svg class="mobile-dropdown-arrow" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 18 18" fill="none" style="margin-left: 4px; transition: transform 0.3s ease;">
                <path d="M4.5 6.75L9 11.25L13.5 6.75" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </a>
            <div class="mobile-toolbar-dropdown" style="position: absolute; top: 100%; left: 50%; transform: translateX(-50%); background: white; border: 1px solid #e5e5e5; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); min-width: 200px; z-index: 1000; opacity: 0; visibility: hidden; transform: translateX(-50%) translateY(-10px); transition: all 0.3s ease; margin-top: 8px;">
              <ul style="list-style: none; margin: 0; padding: 8px 0;">
                {%- for link in toolbar_menu_1.links -%}
                  <li style="margin: 0;">
                    <a href="{{ link.url }}" style="display: block; padding: 12px 16px; text-decoration: none; color: #333; transition: background-color 0.2s ease; font-size: 14px;">{{ link.title }}</a>
            </li>
                {%- endfor -%}
              </ul>
            </div>
          </div>
          {%- endif -%}

        <!-- Right side: Toolbar menu 2 (Showroom) -->
        {%- if section.settings.toolbar_menu_2 != blank -%}
          <div class="mobile-toolbar-menu mobile-toolbar-menu--right">
            <ul class="mobile-toolbar-links" style="list-style: none; margin: 0; padding: 0; display: flex; gap: 0;">
              {%- for link in toolbar_menu_2.links -%}
                <li>
                  <a href="{{ link.url }}" style="text-decoration: none; color: inherit; font-weight: 500; padding: 8px 12px; border-radius: 4px; transition: background-color 0.2s ease;">{{ link.title }}</a>
            </li>
              {%- endfor -%}
        </ul>
          </div>
        {%- endif -%}
      </div>
    </div>
  </div>
</div>

<style>
/* Ensure NavDrawer is always on top layer, above sticky-add-to-cart */
#NavDrawer {
  z-index: 9999 !important;
}

#NavDrawer.drawer {
  z-index: 9999 !important;
}

/* Make sure drawer overlay is also high priority */
.drawer-page-overlay {
  z-index: 9998 !important;
}

/* Mobile header layout in drawer */
#NavDrawer .header-layout--mobile {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 0 12.5px 0;
  width: 100%;
  margin-top: -12.5px;
}

#NavDrawer .header-layout--mobile .header-item--left,
#NavDrawer .header-layout--mobile .header-item--icons {
  display: flex;
  align-items: center;
  flex: 1;
}

#NavDrawer .header-layout--mobile .header-item--left {
  justify-content: flex-start;
}

#NavDrawer .header-layout--mobile .header-item--icons {
  justify-content: flex-end;
}

#NavDrawer .header-layout--mobile .header-item--logo {
  flex-shrink: 0;
  padding: 0 15px;
}

/* Remove padding top from logo in drawer */
#NavDrawer .header-layout--mobile .site-header__logo-link {
  padding-top: 0 !important;
}

/* Ensure all icons have consistent size and weight */
#NavDrawer .header-layout--mobile .site-nav__link--icon svg,
#NavDrawer .header-layout--mobile .icon,
#NavDrawer .header-layout--mobile .icon-close,
#NavDrawer .header-layout--mobile .icon-search {
  width: 22px !important;
  height: 22px !important;
  stroke-width: 2 !important;
}

#NavDrawer .header-layout--mobile .site-nav__link--icon {
  padding: 8px !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
}

/* Ensure drawer__contents has proper flex layout for mobile-drawer-bottom */
#NavDrawer .drawer__contents {
  display: flex !important;
  flex-direction: column !important;
  height: 100% !important;
}

/* Ensure drawer__scrollable takes remaining space */
#NavDrawer .drawer__scrollable {
  flex: 1 !important;
  overflow-y: auto !important;
  min-height: 0 !important;
}

/* Mobile drawer bottom section styling - now outside drawer__scrollable */
.mobile-drawer-bottom {
  margin-top: 0;
  padding: 0 3px;
  height: 49px;
  background-color: #F5F9FF;
  border-top: 1px solid #e5e5e5;
  display: flex !important;
  align-items: center !important;
  justify-content: space-between !important;
  flex-wrap: nowrap !important;
  visibility: visible !important;
  opacity: 1 !important;
  flex-shrink: 0;
  position: relative;
  z-index: 10;
}

.mobile-lang {
  flex: 0 0 auto;
  min-width: 30px;
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
  width: 30px !important;
  height: 30px !important;
  max-width: 30px !important;
  max-height: 30px !important;
}

/* Force language selector to be visible in mobile drawer - compact 30px */
#NavDrawer .mobile-lang,
#NavDrawer .multi-selectors,
#NavDrawer .multi-selectors__item,
#NavDrawer .disclosure[data-disclosure-locale] {
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
  position: static !important;
  height: 30px !important;
  width: 30px !important;
  overflow: visible !important;
  max-width: 30px !important;
  max-height: 30px !important;
  min-width: 30px !important;
  min-height: 30px !important;
}

/* Group center and right menus together on the right side */
.mobile-toolbar-menu--center,
.mobile-toolbar-menu--right {
  flex: 0 0 auto;
  min-width: 0;
}

/* Create a container for both center and right menus */
.mobile-toolbar-menus-group {
  display: flex !important;
  align-items: center !important;
  gap: 16px !important;
  flex: 0 0 auto !important;
}

.mobile-toolbar-menus {
  gap: 16px;
}

.mobile-toolbar-menu {
  display: flex;
  align-items: center;
}

.mobile-toolbar-links {
  display: flex;
  gap: 0;
  list-style: none;
  margin: 0;
  padding: 0;
}

.mobile-toolbar-links li {
  margin: 0;
}

.mobile-toolbar-links a {
  text-decoration: none;
  color: inherit;
  font-weight: 500;
  transition: color 0.2s ease;
}

.mobile-toolbar-links a:hover {
  color: #007bff;
}

/* Specifically for mobile - ensure drawer is above sticky cart */
@media screen and (max-width: 749px) {
  #NavDrawer {
    z-index: 9999 !important;
    position: fixed !important;
  }
  
  #NavDrawer.drawer {
    z-index: 9999 !important;
  }
  
  .drawer-page-overlay {
    z-index: 9998 !important;
  }
  
  /* Ensure drawer content is also properly layered */
  #NavDrawer .drawer__contents {
    z-index: 9999 !important;
    position: relative;
  }
  
  /* Mobile responsive adjustments - keep horizontal layout */
  .mobile-drawer-bottom {
    flex-direction: row !important;
    gap: 8px;
    align-items: center !important;
    justify-content: space-between !important;
    flex-wrap: nowrap !important;
    padding: 15px 0;
  }
  
  .mobile-lang {
    flex: 0 0 auto;
    min-width: 0;
  }
  
  .mobile-toolbar-menu--center {
    flex: 0 0 auto;
    min-width: 0;
  }
  
  .mobile-toolbar-menu--right {
    flex: 0 0 auto;
    min-width: 0;
  }
  
  .mobile-toolbar-links {
    gap: 0;
  }
  
  .mobile-toolbar-links a {
    font-size: 14px;
    padding: 6px 8px;
  }
}

/* Dropdown functionality */
.mobile-toolbar-trigger:hover {
  background-color: #f8f9fa;
}

.mobile-toolbar-trigger.active .mobile-dropdown-arrow {
  transform: rotate(180deg);
}

.mobile-toolbar-dropdown.show {
  opacity: 1 !important;
  visibility: visible !important;
  transform: translateX(-50%) translateY(0) !important;
}

.mobile-toolbar-dropdown a:hover {
  background-color: #f8f9fa;
}

/* Language flags styling using SVG files */
.language-flag {
  display: inline-block;
  width: 22px;
  height: 13px;
  flex-shrink: 0;
}

/* Language flag styling - no container needed */

/* Language arrow removed - no longer needed */

/* Ensure language selector is visible - compact 30px */
.disclosure[data-disclosure-locale] {
  display: flex !important;
  visibility: visible !important;
  opacity: 1 !important;
  width: 30px !important;
  height: 30px !important;
  min-width: 30px !important;
  min-height: 30px !important;
  max-width: 30px !important;
  max-height: 30px !important;
}

/* Override any hidden styles for language selector - compact 30px */
.multi-selectors__item {
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
  width: 30px !important;
  height: 30px !important;
  min-width: 30px !important;
  min-height: 30px !important;
  max-width: 30px !important;
  max-height: 30px !important;
}

.multi-selectors {
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
  width: 30px !important;
  height: 30px !important;
  min-width: 30px !important;
  min-height: 30px !important;
  max-width: 30px !important;
  max-height: 30px !important;
}

.language-flag img {
  width: 100%;
  height: 100%;
  display: block;
  border-radius: 2px;
}

/* Language toggle text styling - compact */
.language-toggle-text {
  font-family: 'Be Vietnam Pro', sans-serif;
  font-size: 8px;
  font-weight: 500;
  color: #1C2C58;
  line-height: 1;
  text-align: center;
  margin-top: 2px;
  display: none;
}

/* Language selector button styling */
.disclosure[data-disclosure-locale] .faux-select {
  display: flex !important;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 4px;
  background: transparent;
  border: none;
  border-radius: 0;
  cursor: pointer;
  transition: all 0.2s ease;
  visibility: visible !important;
  opacity: 1 !important;
  position: static !important;
  width: 30px !important;
  height: 30px !important;
  gap: 2px;
  min-width: 30px;
  min-height: 30px;
}

/* Force button visibility in mobile drawer */
#NavDrawer .disclosure[data-disclosure-locale] .faux-select {
  display: flex !important;
  visibility: visible !important;
  opacity: 1 !important;
  position: static !important;
  height: auto !important;
  width: auto !important;
  padding-left: 15px !important;
}

.disclosure[data-disclosure-locale] .faux-select:hover {
  background-color: transparent;
  border-color: transparent;
}

.disclosure[data-disclosure-locale] .icon-chevron-down {
  width: 12px;
  height: 12px;
  margin-left: 4px;
  transition: transform 0.2s ease;
}

.disclosure[data-disclosure-locale] .faux-select[aria-expanded="true"] .icon-chevron-down {
  transform: rotate(180deg);
}

.disclosure-list__option {
  display: flex;
  align-items: center;
  padding: 8px 12px;
  text-decoration: none;
  color: #333;
  transition: background-color 0.2s ease;
}

.disclosure-list__option:hover {
  background-color: #f8f9fa;
}

.disclosure-list__option .language-flag {
  margin-right: 8px;
  flex-shrink: 0;
}

.disclosure-list__option .disclosure-list__label {
  font-size: 14px;
  font-weight: 500;
}

/* Language dropdown positioning - desktop below, mobile above */
.disclosure-list {
  position: absolute;
  left: 50%;
  transform: translateX(-80%);
  background: white;
  border: 1px solid #e5e5e5;
  border-radius: 6px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  min-width: 80px;
  z-index: 1000;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
  padding: 8px 0;
}

/* Desktop: show below the flag */
@media (min-width: 769px) {
  .disclosure-list {
    top: 100%;
    margin-top: 8px;
    transform: translateX(-55%) translateY(30%);  }
}

/* Mobile: show above the flag */
@media (max-width: 768px) {
  .disclosure-list {
    bottom: 100%;
    margin-bottom: 8px;
    transform: translateX(-50%) translateY(10px);
  }
}

.disclosure-list.show {
  opacity: 1;
  visibility: visible;
  transform: translateX(-55%) translateY(30%);
}

/* Mobile: show above animation */
@media (max-width: 768px) {
  .disclosure-list.show {
    transform: translateX(-50%) translateY(0);
  }
}

/* --- Custom styles for drawer megamenu (v2) --- */

/* Title of the slide-out menu and sub-groups */
.megamenu__content .site-nav__dropdown-link--top-level.js-megamenu-close {
  width: auto !important; /* Fixed width is not ideal for responsive titles */
  height: auto !important;
  color: #1C2C58 !important;
  font-family: "Be Vietnam Pro", sans-serif !important;
  font-size: clamp(18px, 5.3vw, 20px) !important;
  font-style: normal !important;
  font-weight: 600 !important;
  line-height: 1.2 !important; /* 24px on 20px font */
  letter-spacing: 0.6px !important;
  padding: 5px 0 !important;
}

/* Container for each sub-item in the menu */
.megamenu__grandchild-item {
  margin-bottom: 10px !important;
}

/* The link itself, acting as a flex container for image and text */
.megamenu__grandchild-item > .site-nav__dropdown-link {
  display: flex !important;
  align-items: center !important;
  gap: 12px !important;
  text-decoration: none !important;
}

/* Image container */
.megamenu__grandchild-item .aspect-ratio {
  width: 18.1vw !important;
  max-width: 68px !important;
  aspect-ratio: 68 / 50 !important;
  height: auto !important;
  flex-shrink: 0 !important;
  border-radius: 4px !important;
  overflow: hidden !important;
}

.megamenu__grandchild-item .aspect-ratio img {
    width: 100% !important;
    height: 100% !important;
    object-fit: cover !important;
}

/* Span for the grandchild link title */
.megamenu__grandchild-title {
  display: block !important;
  height: auto !important; /* Fixed height is not recommended with responsive text */
  flex-shrink: 0 !important;
  color: #121212 !important;
  font-family: "Be Vietnam Pro", sans-serif !important;
  font-size: clamp(14px, 4.2vw, 16px) !important;
  font-style: normal !important;
  font-weight: 500 !important;
  line-height: 1.5 !important; /* 24px on 16px font */
  letter-spacing: 0.6px !important;
  white-space: nowrap !important;
  overflow: hidden !important;
  text-overflow: ellipsis !important;
}

.show-more-btn.text-sm {
  background: none !important;
  padding: 0 !important;
  border-radius: 0 !important;
  color: #1C2C58 !important;
  text-align: right !important;
  font-family: "Be Vietnam Pro", sans-serif !important;
  font-size: 14px !important;
  font-style: normal !important;
  font-weight: 400 !important;
  line-height: 28.8px !important;
  text-decoration-line: underline !important;
  text-decoration-style: solid !important;
  text-decoration-skip-ink: auto !important;
  text-decoration-thickness: auto !important;
  text-underline-offset: auto !important;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Mobile toolbar dropdown functionality
  const mobileToolbarTrigger = document.querySelector('.mobile-toolbar-trigger');
  const mobileToolbarDropdown = document.querySelector('.mobile-toolbar-dropdown');
  
  if (mobileToolbarTrigger && mobileToolbarDropdown) {
    // Toggle dropdown on click
    mobileToolbarTrigger.addEventListener('click', function(e) {
      e.preventDefault();
      
      // Close other dropdowns first
      const allDropdowns = document.querySelectorAll('.mobile-toolbar-dropdown');
      allDropdowns.forEach(dropdown => {
        if (dropdown !== mobileToolbarDropdown) {
          dropdown.classList.remove('show');
        }
      });
      
      // Toggle current dropdown
      mobileToolbarDropdown.classList.toggle('show');
      mobileToolbarTrigger.classList.toggle('active');
    });
    
    // Close dropdown when clicking outside
    document.addEventListener('click', function(e) {
      if (!mobileToolbarTrigger.contains(e.target) && !mobileToolbarDropdown.contains(e.target)) {
        mobileToolbarDropdown.classList.remove('show');
        mobileToolbarTrigger.classList.remove('active');
      }
    });
    
    // Close dropdown when clicking on a link
    const dropdownLinks = mobileToolbarDropdown.querySelectorAll('a');
    dropdownLinks.forEach(link => {
      link.addEventListener('click', function() {
        mobileToolbarDropdown.classList.remove('show');
        mobileToolbarTrigger.classList.remove('active');
      });
    });
  }

  // Language selector dropdown functionality
  const languageTriggers = document.querySelectorAll('.disclosure[data-disclosure-locale] .faux-select');
  const languageDropdowns = document.querySelectorAll('.disclosure-list[data-disclosure-list]');
  
  languageTriggers.forEach(trigger => {
    const dropdown = trigger.parentElement.querySelector('.disclosure-list');
    
    if (dropdown) {
      trigger.addEventListener('click', function(e) {
        e.preventDefault();
        
        // Close other language dropdowns
        languageDropdowns.forEach(otherDropdown => {
          if (otherDropdown !== dropdown) {
            otherDropdown.classList.remove('show');
          }
        });
        
        // Toggle current dropdown
        dropdown.classList.toggle('show');
      });
    }
  });
  
  // Handle language selection
  const languageOptions = document.querySelectorAll('.disclosure-list__option[data-value]');
  languageOptions.forEach(option => {
    option.addEventListener('click', function(e) {
      e.preventDefault();
      
      const selectedLang = this.getAttribute('data-value');
      const currentPath = window.location.pathname;
      let newPath = currentPath;
      
      // Remove existing language prefix if any
      if (currentPath.startsWith('/en/')) {
        newPath = currentPath.replace('/en/', '/');
      } else if (currentPath === '/en') {
        newPath = '/';
      }
      
      // Add language prefix for English
      if (selectedLang === 'en') {
        if (newPath === '/') {
          newPath = '/en';
        } else {
          newPath = '/en' + newPath;
        }
      }
      
      // Navigate to new URL
      window.location.href = newPath;
    });
  });
  
  // Close language dropdowns when clicking outside
  document.addEventListener('click', function(e) {
    if (!e.target.closest('.disclosure[data-disclosure-locale]')) {
      languageDropdowns.forEach(dropdown => {
        dropdown.classList.remove('show');
      });
    }
  });
});
</script>
