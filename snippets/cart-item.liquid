<div class="cart__item" data-key="{{ product.key }}">
  <div class="cart__image">
    {% if product.image != blank %}
      <a href="{{ product.url }}" class="image-wrap" style="width: 100px; height: 100px;">
        {%- render 'image-element',
          img: product.image,
          alt: product.product.title,
          widths: '200',
          sizes: '100px'
        -%}
      </a>
    {% endif %}
  </div>
  <div class="cart__item-details">
    <a href="{{ product.url }}" class="cart-item__title">
      {{ product.product.title }}
    </a>
    {%- unless product.product.has_only_default_variant -%}
      <div class="cart-item__variant">
        {%- for option in product.options_with_values -%}
          <div>{{ option.name }}: {{ option.value }}</div>
        {%- endfor -%}
      </div>
    {%- endunless -%}

    <div class="cart-item__price-wrapper">
        {%- comment -%}
            Check if there's any discount to display. This can be either:
            1. A "compare at" price on the variant (a sale).
            2. A cart-level discount making final_price different from original_price.
        {%- endcomment -%}
        {%- if product.variant.compare_at_price > product.price or product.original_price != product.final_price -%}
            
            {%- comment -%}
                Determine the strikethrough price. 
                If it's a sale item, the strikethrough should be the 'compare at price'.
                Otherwise, it's the original price before cart discounts.
            {%- endcomment -%}
            <span class="cart-item__price--original">
                {%- if product.variant.compare_at_price > product.price -%}
                    {{ product.variant.compare_at_price | money }}
                {%- else -%}
                    {{ product.original_price | money }}
                {%- endif -%}
            </span>

            <span class="cart-item__price--final">{{ product.final_price | money }}</span>

        {%- else -%}
            {%- comment -%} No discounts, just show the final price. {%- endcomment -%}
            <span class="cart-item__price--final">{{ product.final_price | money }}</span>
        {%- endif -%}
    </div>
    
    <div class="cart-item__footer">
        <a href="{{ routes.cart_change_url }}?id={{ product.key }}&amp;quantity=0" class="cart-item__remove" data-id="{{ product.key }}">
            Xóa bỏ
        </a>
        <div class="js-qty__wrapper">
            <button type="button" class="js-qty__adjust js-qty__adjust--minus" aria-label="{{ 'cart.general.reduce_quantity' | t }}">
                &minus;
            </button>
            <input
                type="text"
                class="js-qty__num"
                value="{{ product.quantity }}"
                min="0"
                pattern="[0-9]*"
                data-id="{{ product.key }}"
                aria-label="{{ 'cart.label.quantity' | t }}"
            >
            <button type="button" class="js-qty__adjust js-qty__adjust--plus" aria-label="{{ 'cart.general.increase_quantity' | t }}">
                +
            </button>
        </div>
    </div>

    {%- if product.selling_plan_allocation != empty -%}
      <div class="cart-item__variant">
        {{ product.selling_plan_allocation.selling_plan.name }}
      </div>
    {%- endif -%}

    {%- assign property_size = product.properties | size -%}
    {% if property_size > 0 %}
      {% for p in product.properties %}
        {%- assign first_character_in_key = p.first | truncate: 1, '' -%}
        {% unless p.last == blank or first_character_in_key == '_' %}
          <div class="cart-item__variant">
            <div>
              <span>{{ p.first }}:</span>
              {% if p.last contains '/uploads/' %}
                <a href="{{ p.last }}">{{ p.last | split: '/' | last }}</a>
              {% else %}
                {{ p.last }}
              {% endif %}
            </div>
          </div>
        {% endunless %}
      {% endfor %}
    {% endif %}
  </div>
</div>
