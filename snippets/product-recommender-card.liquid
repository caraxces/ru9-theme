{% comment %}
  Snippet hi·ªÉn th·ªã card s·∫£n ph·∫©m trong product recommender
  S·ª≠ d·ª•ng: {% render 'product-recommender-card', product_handle: 'handle-san-pham' %}
{% endcomment %}

{% assign product = all_products[product_handle] %}

{% if product != blank %}
  <div class="product-recommender__product-card" data-product-handle="{{ product_handle }}">
    <div class="product-card">
      {% if product.featured_image %}
        <div class="product-card__image">
          <img src="{{ product.featured_image | img_url: '200x200' }}" 
               alt="{{ product.title }}" 
               width="200"
               height="200"
               loading="lazy">
        </div>
      {% endif %}
      
      <div class="product-card__content">
        <h4 class="product-card__title">{{ product.title }}</h4>
        
        {% if product.price %}
          <div class="product-card__price">
            {% if product.compare_at_price > product.price %}
              <span class="product-card__price--sale">{{ product.price | money_with_currency }}</span>
              <span class="product-card__price--compare">{{ product.compare_at_price | money_with_currency }}</span>
            {% else %}
              <span class="product-card__price--regular">{{ product.price | money_with_currency }}</span>
            {% endif %}
          </div>
        {% endif %}
        
        {% if product.description %}
          <div class="product-card__description">
            {{ product.description | strip_html | truncate: 80 }}
          </div>
        {% endif %}
        
        <div class="product-card__actions">
          <a href="{{ product.url }}" class="btn btn--primary btn--small" target="_blank">
            Xem chi ti·∫øt
          </a>
          {% if product.available %}
            <button class="btn btn--secondary btn--small" onclick="addToCartQuick('{{ product.variants.first.id }}')">
              Th√™m v√†o gi·ªè
            </button>
          {% else %}
            <span class="btn btn--disabled btn--small">H·∫øt h√†ng</span>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
{% else %}
  <div class="product-recommender__product-card" data-product-handle="{{ product_handle }}">
    <div class="product-card product-card--placeholder">
      <div class="product-card__content">
        <h4 class="product-card__title">üì¶ {{ product_handle | replace: '-', ' ' | capitalize }}</h4>
        <p class="product-card__description">S·∫£n ph·∫©m n√†y hi·ªán ch∆∞a c√≥ th√¥ng tin.</p>
        <div class="product-card__actions">
          <a href="/products/{{ product_handle }}" class="btn btn--secondary btn--small" target="_blank">
            Xem chi ti·∫øt
          </a>
        </div>
      </div>
    </div>
  </div>
{% endif %}

<style>
.product-card {
  background: #333;
  border-radius: 12px;
  overflow: hidden;
  transition: all 0.3s ease;
  height: 100%;
  display: flex;
  flex-direction: column;
}

.product-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
}

.product-card__image {
  aspect-ratio: 1;
  overflow: hidden;
}

.product-card__image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.product-card__content {
  padding: 16px;
  flex: 1;
  display: flex;
  flex-direction: column;
}

.product-card__title {
  color: #fff;
  font-size: 1rem;
  font-weight: 600;
  margin-bottom: 8px;
  line-height: 1.3;
}

.product-card__price {
  margin-bottom: 8px;
}

.product-card__price--regular,
.product-card__price--sale {
  color: #4ade80;
  font-weight: 600;
  font-size: 1rem;
}

.product-card__price--compare {
  color: #888;
  text-decoration: line-through;
  font-size: 0.9rem;
  margin-left: 8px;
}

.product-card__description {
  color: #ccc;
  font-size: 0.85rem;
  line-height: 1.4;
  margin-bottom: 12px;
  flex: 1;
}

.product-card__actions {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.product-card__actions .btn {
  flex: 1;
  min-width: 120px;
  text-align: center;
  font-size: 0.8rem;
  padding: 8px 12px;
  border-radius: 6px;
  text-decoration: none;
  cursor: pointer;
  border: none;
  transition: all 0.2s ease;
}

.btn--primary {
  background: #007bff;
  color: #fff;
}

.btn--primary:hover {
  background: #0056b3;
}

.btn--secondary {
  background: transparent;
  color: #ccc;
  border: 1px solid #555;
}

.btn--secondary:hover {
  background: #555;
  color: #fff;
}

.btn--disabled {
  background: #444;
  color: #666;
  cursor: not-allowed;
}

.product-card--placeholder {
  border: 2px dashed #555;
  background: transparent;
}

.product-card--placeholder .product-card__title {
  color: #888;
}

.product-card--placeholder .product-card__description {
  color: #666;
}
</style>

<script>
function addToCartQuick(variantId) {
  // Logic th√™m s·∫£n ph·∫©m v√†o gi·ªè h√†ng nhanh
  const formData = new FormData();
  formData.append('items[0][id]', variantId);
  formData.append('items[0][quantity]', 1);
  
  fetch('/cart/add.js', {
    method: 'POST',
    body: formData
  })
  .then(response => response.json())
  .then(data => {
    // Hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng
    if (window.theme && window.theme.cart) {
      window.theme.cart.updateCartCount();
    }
    
    // Hi·ªÉn th·ªã notification
    const notification = document.createElement('div');
    notification.className = 'cart-notification';
    notification.innerHTML = '‚úÖ ƒê√£ th√™m s·∫£n ph·∫©m v√†o gi·ªè h√†ng!';
    notification.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      background: #4ade80;
      color: #fff;
      padding: 12px 20px;
      border-radius: 8px;
      font-weight: 600;
      z-index: 10000;
      animation: slideInRight 0.3s ease;
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
      notification.remove();
    }, 3000);
  })
  .catch(error => {
    console.error('Error:', error);
    alert('C√≥ l·ªói x·∫£y ra khi th√™m s·∫£n ph·∫©m v√†o gi·ªè h√†ng.');
  });
}

// CSS animation
if (!document.querySelector('#cart-notification-styles')) {
  const style = document.createElement('style');
  style.id = 'cart-notification-styles';
  style.textContent = `
    @keyframes slideInRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
  `;
  document.head.appendChild(style);
}
</script> 