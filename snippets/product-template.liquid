{% comment %}
  Parameters
  context - used to determine whether on the featured product or main product template
  mobile_layout
{% endcomment %}

<style>
  .product-image-container {
    position: relative;
  }
  .product-grid__images {
    position: relative;
  }
  .custom-nav-button {
    display: none; /* Hidden by default */
  }

  @media screen and (min-width: 769px) {
  .product-tags-wrapper {
    position: absolute;
    top: 15px;
    left: 15px;
    z-index: 2;
    display: flex;
    flex-direction: column;
    gap: 8px;
    align-items: flex-start;
  }
}
  .product-tag-item {
    padding: 4px 12px;
    border-radius: 4px;
    font-size: 14px;
    font-weight: 600;
    line-height: 1.4;
    text-align: center;
    max-width: fit-content;
  }
  .product-section {
    font-family: "Be Vietnam Pro", sans-serif;
  }
  .product-block:not(.product-block-bundle) .variant__button-label.disabled:before {
    content: "";
    top: 50%;
    left: -10px;
    height: 1px;
    opacity: 1;
    z-index: 1;
    border: none;
    position: absolute;
    visibility: visible;
    width: calc(100% + 20px);
    background-color: #000;
    transform: translateY(-50%) rotate(-45deg);
  }

  .price-container-wrapper {
    display: flex;
    align-items: center;
    flex-wrap: nowrap;
    gap: 8px; /* Add some space between items */
  }

  .product-block--price .product__price {
    width: 168px;
    flex-shrink: 0;
    color: #1C2C58;
    font-family: "Be Vietnam Pro", sans-serif;
    font-size: 20px;
    font-style: normal;
    font-weight: 600;
    line-height: 150%;
  }

  .product-block--price .product__price--compare {
    width: 165px;
    flex-shrink: 0;
    color: #888;
    font-family: "Be Vietnam Pro", sans-serif;
      font-size: 20px;
    font-style: normal;
    font-weight: 400;
    line-height: 24px;
    text-decoration-line: line-through;
  }

  .product-block--price .product__discount-badge {
    display: flex;
    padding: 0 7px;
    justify-content: center;
    align-items: center;
    border-radius: 5px;
    background: #FCE390;
    color: #1C2C58;
    font-family: "Be Vietnam Pro", sans-serif;
    font-weight: 400;
      font-size: 18px;
    width: auto;
    height: auto;
    line-height: normal;
  }
  .product-single__subtitle {
    color: #1C2C58;
    font-family: "Be Vietnam Pro", sans-serif;
    font-size: 27px;
    font-style: normal;
    font-weight: 600;
    line-height: 140%;
    margin-top: 8px;
    margin-bottom: 15px;
  }
  .variant-picker__items {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
  }
  .variant-picker__item:nth-child(n+5) {
    grid-column: span 2;
  }
  .product-accordion {
    border-bottom: 1px solid #E0E0E0;
  }
  .product-accordion summary {
    padding: 20px 0;
    font-size: 16px;
    font-weight: 600;
    list-style: none;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .product-accordion summary::-webkit-details-marker {
    display: none;
  }
  .product-accordion summary .icon-toggle {
    transition: transform 0.2s;
  }
  .product-accordion[open] summary .icon-toggle {
    transform: rotate(180deg);
  }
  .product-accordion-content {
    padding-bottom: 20px;
  }
  .product-accordion-content img {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    margin-top: 10px;
  }
  .product-accordion--styled {
    border-radius: 5px;
    background: #F5F9FF;
    padding: 0 20px;
    border-bottom: none;
    margin-bottom: 16px;
    flex-shrink: 0;
    max-width: 646px;
  }
  .product-accordion--styled summary {
    padding: 20px 0;
    min-height: 60px;
  }

  .showroom-list .showroom-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid #E0E0E0;
  }
  .showroom-list .showroom-item:last-child {
    border-bottom: none;
  }
  .showroom-list .showroom-item a {
    text-decoration: none;
    color: inherit;
  }
  .showroom-list .showroom-item .showroom-address {
    font-size: 14px;
    font-weight: 400;
    color: #555;
  }
  .showroom-list .showroom-item .showroom-address strong {
    font-weight: 600;
    color: #1C2C58;
    display: block;
    margin-bottom: 4px;
  }
  .showroom-list .showroom-item .showroom-address p {
    margin: 0;
  }
  .showroom-list .showroom-item .phone-link {
    font-size: 14px;
    font-weight: 600;
    color: #1C2C58;
    white-space: nowrap;
    margin-left: 20px;
  }

  .variant__label {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 10px;
    display: block;
  }
  .variant__label-info {
    font-weight: 400;
  }
  .is-size .variant-input-wrap,
  .is-firmness .variant-input-wrap {
    display: grid;
    gap: 16px;
    margin-bottom: 16px;
  }
  .is-size .variant-input,
  .is-firmness .variant-input {
    display: flex;
  }
  .is-size .variant-input-wrap[data-option-count="2"],
  .is-firmness .variant-input-wrap[data-option-count="2"] {
    grid-template-columns: repeat(2, 1fr);
  }
  .is-size .variant-input-wrap[data-option-count="3"],
  .is-firmness .variant-input-wrap[data-option-count="3"] {
    grid-template-columns: repeat(3, 1fr);
  }
  .is-size .variant-input-wrap[data-option-count="4"],
  .is-firmness .variant-input-wrap[data-option-count="4"] {
    grid-template-columns: repeat(4, 1fr);
  }
  .is-size .variant-input-wrap[data-option-count="5"],
  .is-firmness .variant-input-wrap[data-option-count="5"] {
    grid-template-columns: repeat(3, 1fr);
  }
  .is-size .variant-input-wrap[data-option-count="5"] .variant-input:nth-child(n+5),
  .is-firmness .variant-input-wrap[data-option-count="5"] .variant-input:nth-child(n+5) {
    grid-column: span 1; /* Fallback for clean layout */
  }
  .is-size .variant-input-wrap[data-option-count="6"],
  .is-firmness .variant-input-wrap[data-option-count="6"] {
    grid-template-columns: repeat(4, 1fr);
  }
  .is-size .variant-input-wrap[data-option-count="6"] .variant-input:nth-child(n+6),
  .is-firmness .variant-input-wrap[data-option-count="6"] .variant-input:nth-child(n+6) {
    grid-column: span 2;
  }
  .variant-wrapper:not(.is-color) .variant__button-label {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 12px 8px;
    border: 1px solid #E0E0E0;
    border-radius: 5px;
    background-color: #fff;
    cursor: pointer;
    transition: all 0.2s ease-in-out;
    width: 100%;
    min-height: 60px;
    text-align: center;
  }
  .variant-wrapper:not(.is-color) .variant-input input[type="radio"]:checked + .variant__button-label {
    border-color: #234085;
    background-color: #F5F9FF;
  }
  .variant-wrapper:not(.is-color) .variant__button-label .label-head,
  .variant-wrapper:not(.is-color) .variant__button-label .label-value {
    display: block;
  }
  .variant-wrapper:not(.is-color) .variant__button-label .label-head {
    font-size: 16px;
    font-weight: 600;
    color: #1C2C58;
  }
  .variant-wrapper:not(.is-color) .variant__button-label .label-value {
    font-size: 14px;
    font-weight: 400;
    color: #555;
  }
  .promotion-block-container {
    margin-bottom: 20px;
  }
  .promotion-title {
    font-size: 16px;
    font-weight: 600;
    margin: 0;
    white-space: nowrap;
  }
  .promotion-vouchers {
    display: flex;
    max-width: 646px;
    width: 100%;
    min-height: 55px;
    padding: 4px 16px;
    justify-content: flex-start;
    align-items: center;
    gap: 20px;
    flex-shrink: 0;
    border-radius: 5px;
    background: #F5F5F5;
    flex-wrap: wrap;
  }
  .promotion-voucher-item {
    cursor: pointer;
    background: none;
    border: none;
    padding: 0;
  }
  .promotion-voucher-item img {
    display: block;
    width: 84.99px;
    height: 36.902px;
    flex-shrink: 0;
    object-fit: contain;
  }
  .promotion-popup-modal .popup-modal__content {
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    color: white;
  }
  .promotion-popup-modal .popup-modal__content-info {
    background-color: rgba(0, 0, 0, 0.5);
    padding: 40px;
    border-radius: 8px;
  }

  .service-block {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
  }

  .service-block__icon {
    flex-shrink: 0;
  }

  .service-block__text p {
    color: #1C2C58;
    font-family: "Be Vietnam Pro", sans-serif;
    font-size: 27px;
    font-style: normal;
    font-weight: 600;
    line-height: 140%;
    margin: 0;
  }

  .service-carousel-wrapper {
    width: 100%;
    height: 94px;
    flex-shrink: 0;
    border-radius: 5px;
    background: #F5F9FF;
    padding: 0 50px;
    box-sizing: border-box;
    position: relative;
    display: flex;
    align-items: center;
  }

  .service-carousel {
    width: 100%;
  }

  .service-carousel-cell {
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  
  .service-carousel-wrapper .flickity-prev-next-button {
    width: 36px;
    height: 36px;
    background-color: transparent;
    border-radius: 50%;
    box-shadow: none;
    background-repeat: no-repeat;
    background-position: center;
    background-size: 14px;
  }

  .service-carousel-wrapper .flickity-prev-next-button .flickity-button-icon {
    display: none;
  }

  .service-carousel-wrapper .flickity-prev-next-button.previous {
    left: 10px;
    background-color: #fff;
    border: 1px solid #EBEBEB;
    background-image: url('{{ "nav-next.svg" | asset_url }}');
    transform: scaleX(-1);
  }

  .service-carousel-wrapper .flickity-prev-next-button.next {
    right: 10px;
    background-color: #234085;
    background-image: url('{{ "nav-next.svg" | asset_url }}');
  }

  .product-grid {
    align-items: start;
  }
  .is-sticky {
    position: -webkit-sticky;
    position: sticky;
    top: 120px; /* Adjust this value to sit below your site's sticky header */
    align-self: start; /* Ensures the column aligns to the top of the grid row */
  }

  .service-carousel-wrapper .flickity-page-dots {
    display: none;
  }

  @media screen and (min-width: 769px) {
    .product-section > .page-content > .page-width {
      max-width: 100%;
      padding-left: 120px;
      padding-right: 110px;
    }
  }

  .product-grid {
    display: grid;
    grid-gap: 20px;
    align-items: start;
  }

  .product-grid--medium .product-grid__images {
    grid-column: span 7 / span 7;
  }
  
  /* 
    Definitive Pure CSS Sticky Column Solution
  */
  @media screen and (min-width: 991px) {
    /*
      CRITICAL FIX: `position: sticky` will NOT work if any parent element
      has `overflow` set to 'hidden', 'scroll', or 'auto'.
      This rule aggressively targets all potential parent containers in the product grid
      and forces them to allow sticky positioning.
    */
    .product-section,
    .page-content--product,
    .page-content--product > .page-width,
    .grid {
      overflow: visible !important;
    }

    /*
      Disable theme's default sticky behavior on images.
      A custom script will handle advanced sticky positioning for either column.
    */
    .product-section .product-single__sticky .sticky {
        position: static; /* Let JS control positioning */
    }
  }

  /* START: Mobile layout styles based on design */
  @media screen and (max-width: 768px) {
    .product-section > .page-content > .page-width {
      padding-left: 16px;
      padding-right: 16px;
    }
    .product-tags-wrapper {
      position: absolute;
      top: 15px;
      left: 0px !important;
      z-index: 2;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: flex-start;
    }
    /* Full-width main image based on request */
    .product__main-photos {
      height: 390px;
      width: calc(100% + 32px);
      margin-left: -16px;
      margin-right: -16px;
      flex-shrink: 0;
      overflow: hidden;
      position: relative;
    }
    .product__photos img{
      border-radius: 0 !important;
    }

    .product__main-photos .product-main-slide {
      height: 100%;
    }

    .product__main-photos .product-main-slide img,
    .product__main-photos .product-main-slide .media--image {
        height: 100%;
        object-fit: cover;
    }

    /* Hide thumbnails on mobile */
    .product__thumbs {
      display: none;
    }

    .product-single__meta .jdgm-widget--product-rating {
      margin-bottom: 8px;
    }

    .product-single__title {
      font-size: 24px;
      line-height: 1.3;
    }

    .product-single__subtitle {
      font-size: 16px;
      font-weight: 400;
      margin-top: 4px;
      margin-bottom: 24px;
    }
    
    .product-block--price {
      margin-bottom: 24px;
    }

    .price-container-wrapper {
      flex-wrap: wrap;
      gap: 12px;
    }

    .product-block--price .product__price {
      font-size: 24px;
      font-weight: 600;
      width: auto;
    }
    .product-block--price [data-product-price-wrap] {
      order: 3;
      flex-basis: 100%;
    }
    .product-block--price .product__price--compare {
      font-size: 18px;
      width: auto;
    }
    .product-block--price .product__discount-badge {
      font-size: 16px;
      padding: 2px 8px;
    }

    .promotion-block-container {
      margin-bottom: 24px;
    }
    .promotion-vouchers {
      gap: 8px;
      padding: 12px;
    }
    .promotion-title {
      width: 100%;
      margin-bottom: 4px;
      text-align: left;
    }

    .variant__label {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 12px;
    }
    
    .is-size .variant-input-wrap {
      grid-template-columns: repeat(3, 1fr) !important;
      gap: 2px;
    }
    .is-size .variant-input-wrap .variant-input {
      grid-column: unset !important;
    }
    .is-size .variant-input-wrap[data-option-count="6"] {
        /* Specific override for 6 items to create 3x2 grid */
        grid-template-columns: repeat(3, 1fr) !important;
    }
    
    .variant-wrapper:not(.is-color) .variant__button-label {
      min-height: 50px;
      padding: 8px;
    }
    
    .variant-wrapper:not(.is-color) .variant__button-label .label-head {
      font-size: 14px;
    }

    .variant-wrapper:not(.is-color) .variant__button-label .label-value {
      font-size: 12px;
    }

    .size-guide-text-dropdown-container,
    .product-accordion--styled {
      padding: 0 16px;
      margin-left: -16px;
      margin-right: -16px;
      max-width: calc(100% + 32px);
      width: calc(100% + 32px);
      border-radius: 0;
      background: #F5F9FF;
    }
    .size-guide-text-trigger,
    .product-accordion--styled summary {
      min-height: 50px;
      font-size: 16px;
      padding: 16px 0;
    }

    .is-firmness .variant-input-wrap {
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
    }

    .product-form__buttons .btn {
      width: 100%;
      max-width: 100%;
      height: 50px;
      font-size: 16px;
      font-weight: bold;
    }

    .product-single__meta .product-block {
      margin-bottom: 24px;
    }
    
    .product-single__meta hr {
      display: none;
    }
    
    /* Main picture nav buttons */
    .product__main-photos .product-slideshow .flickity-prev-next-button,
    .service-carousel-wrapper .flickity-prev-next-button {
      display: block !important;
      visibility: visible !important;
      opacity: 1 !important;
      width: 22px;
      height: 22px;
      top: 50%;
      background: #234085;
      border-radius: 100px;
      background-repeat: no-repeat;
      background-position: center;
      background-size: 10px auto;
      z-index: 999;
    }
    
    .product__main-photos .product-slideshow .flickity-prev-next-button .flickity-button-icon,
    .service-carousel-wrapper .flickity-prev-next-button .flickity-button-icon {
      display: none;
    }

    .product__main-photos .product-slideshow .flickity-prev-next-button.previous,
    .service-carousel-wrapper .flickity-prev-next-button.previous {
      left: 16px;
      background-image: url("data:image/svg+xml,%3csvg width='17' height='9' viewBox='0 0 17 9' fill='none' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M2 1.5L8.5 7.5L15 1.5' stroke='white' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'/%3e%3c/svg%3e");
      transform: translateY(-50%) rotate(90deg);
    }

    .product__main-photos .product-slideshow .flickity-prev-next-button.next,
    .service-carousel-wrapper .flickity-prev-next-button.next {
      right: 16px;
      background-image: url("data:image/svg+xml,%3csvg width='17' height='9' viewBox='0 0 17 9' fill='none' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M2 1.5L8.5 7.5L15 1.5' stroke='white' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'/%3e%3c/svg%3e");
      transform: translateY(-50%) rotate(-90deg);
    }

    .custom-nav-button {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      z-index: 5;
      border-radius: 100px;
      background: #234085;
      display: flex;
      width: 22px;
      height: 22px;
      justify-content: center;
      align-items: center;
      border: none;
      cursor: pointer;
      padding: 0;
    }

    .custom-nav-prev {
      left: 16px;
    }

    .custom-nav-next {
      right: 16px;
    }

    .custom-nav-button svg {
      width: 10px;
      height: auto;
    }

    .custom-nav-prev svg {
      transform: rotate(90deg);
    }

    .custom-nav-next svg {
      transform: rotate(-90deg);
    }
  }
  /* END: Mobile layout styles */
</style>

{%- liquid
  assign current_variant = product.selected_or_first_available_variant

  unless thumbnail_position
    assign thumbnail_position = 'beside'
  endunless

  assign product_zoom_size = '1800x1800'
  assign product_image_size = '620x'

  case image_container_width
    when 'small'
      assign product_image_width = 'medium-up--two-fifths'
      assign product_description_width = 'medium-up--three-fifths'
      assign product_image_size = '480x'
    when 'medium'
      assign product_image_width = 'large-up--one-half'
      assign product_description_width = 'large-up--one-half'
      assign product_image_size = '620x'
    when 'large'
      assign product_image_width = 'large-up--three-fifths'
      assign product_description_width = 'large-up--two-fifths'
      assign product_image_size = '740x'
  endcase

  assign product_img_structure = product.featured_media | img_url: '1x1' | replace: '_1x1.', '_{width}x.'
-%}

{%- liquid
  assign connect_to_sizechart = false

  for block in section.blocks
    if block.type == 'size_chart'
      assign sizechart_index = forloop.index0
      assign next_block_index = sizechart_index | plus: 1
      assign variant_block = section.blocks[next_block_index]

      if variant_block.type == 'variant_picker' and variant_block.settings.picker_type == 'button' and product.has_only_default_variant == false
        for option in product.options_with_values
          assign size_trigger = 'products.general.size_trigger' | t | downcase
          assign downcased_option = option.name | downcase

          if downcased_option contains size_trigger
            assign connect_to_sizechart = true
          endif
        endfor
      endif
    endif
  endfor
-%}

<div
  id="ProductSection-{{ section_id }}-{{ product.id }}"
  class="product-section"
  data-section-id="{{ section_id }}"
  data-product-id="{{ product.id }}"
  data-section-type="product"
  data-product-handle="{{ product.handle }}"
  data-product-title="{{ product.title | escape }}"
  data-product-url="{{ product.url | within: collection }}"
  data-aspect-ratio="{{ 100 | divided_by: product.featured_media.aspect_ratio }}"
  data-img-url="{{ product_img_structure }}"
  {% unless isModal %}
    data-history="true"
  {% endunless %}
  data-modal="{{ isModal }}"
>
  {%- render 'product-template-variables', product: product, current_variant: current_variant -%}

  <div class="page-content page-content--product">
    <div class="page-width">
      {%- if settings.show_breadcrumbs and isModal != true -%}
        {%- render 'breadcrumbs', classes: 'spacing-base' -%}
      {%- endif -%}

      <div class="grid{% unless image_position == 'left' %} grid--product-images-right{% endunless %}{% if mobile_layout == 'partial' %} grid--product-images--partial{% endif %}">
        {%- if image_position == 'left' -%}
          <div class="grid__item {{ product_image_width }} product-single__sticky product-grid__images">
            {%- render 'product-images',
              section_id: section_id,
              product: product,
              product_zoom_enable: section.settings.product_zoom_enable,
              product_zoom_size: product_zoom_size,
              product_carousel_enable: section.settings.product_carousel_enable,
              thumbnail_position: section.settings.thumbnail_position,
              thumbnail_height: section.settings.thumbnail_height,
              thumbnail_arrows: section.settings.thumbnail_arrows,
              mobile_layout: section.settings.mobile_layout,
              blocks: section.blocks
            -%}
            <button class="custom-nav-button custom-nav-prev" aria-label="Previous image">
              <svg width="17" height="9" viewBox="0 0 17 9" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2 1.5L8.5 7.5L15 1.5" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
            <button class="custom-nav-button custom-nav-next" aria-label="Next image">
              <svg width="17" height="9" viewBox="0 0 17 9" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2 1.5L8.5 7.5L15 1.5" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
          </div>
        {%- endif -%}

        <div class="grid__item {{ product_description_width }} product-grid__info">
          <div class="product-single__meta product-info-inner">
            <div class="product-block product-block--header">
              {%- if settings.vendor_enable -%}
                <div class="product-single__vendor">
                  {%- assign vendor_handle = product.vendor | handleize -%}
                  {%- if collections[vendor_handle] != empty -%}
                    <a href="{{ routes.collections_url }}/{{ collections[vendor_handle].handle }}">
                      {{ collections[vendor_handle].title }}
                    </a>
                  {%- else -%}
                    {{ product.vendor | link_to_vendor }}
                  {%- endif -%}
                </div>
              {%- endif -%}

              {%- if isModal -%}
                <p class="h2 product-single__title">
                  {{ product.title }}
                </p>
              {%- else -%}
                <h1 class="h2 product-single__title">
                  {%- unless product.empty? -%}
                    {{ product.title }}
                  {%- else -%}
                    {{ 'home_page.onboarding.product_title' | t }}
                  {%- endunless -%}
                </h1>
              {%- endif -%}

              {%- if section.settings.product_subtitle != blank -%}
                <div class="product-single__subtitle">
                  {{ section.settings.product_subtitle }}
                </div>
              {%- endif -%}

              {%- if sku_enable -%}
                <p data-sku class="product-single__sku">
                  {%- if current_variant.sku -%}
                    {{ current_variant.sku }}
                  {%- endif -%}
                </p>
              {%- endif -%}
            </div>

            <div data-product-blocks>
              {%- capture form_id -%}AddToCartForm-{{ section_id }}-{{ product.id }}{%- endcapture -%}

              {%- for block in blocks -%}
                {%- case block.type -%}
                  {%- when '@app' -%}
                    {% render block %}
                  {%- when 'promotion' -%}
                    <div class="product-block promotion-block-container" {{ block.shopify_attributes }}>
                      <div class="promotion-vouchers">
                        <h3 class="promotion-title">{{ block.settings.title }}</h3>
                        {%- for i in (1..4) -%}
                          {%- capture voucher_image -%}voucher_image_{{ i }}{%- endcapture -%}
                          {%- if block.settings[voucher_image] != blank -%}
                            <modal-opener data-modal="#PromotionPopup-{{ block.id }}-{{ i }}">
                              <button
                                class="promotion-voucher-item"
                                aria-label="Open promotion details"
                              >
                                <img
                                  src="{{ block.settings[voucher_image] | img_url: 'master' }}"
                                  alt="{{ block.settings[voucher_image].alt | default: 'Mã ưu đãi' }}"
                                  width="85"
                                  height="37"
                                >
                              </button>
                            </modal-opener>
                          {%- endif -%}
                        {%- endfor -%}
                        </div>
                    </div>
                  {%- when 'showroom_dropdown' -%}
                    <details class="product-accordion product-accordion--styled" {{ block.shopify_attributes }}>
                      <summary>
                        <span>{{ block.settings.title }}</span>
                        <svg class="icon-toggle" width="18" height="10" viewBox="0 0 18" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1 1.5L9 8.5L17 1.5" stroke="#1C2C58" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                      </summary>
                      <div class="product-accordion-content">
                        <div class="showroom-list showroom-list--accordion">
                          {%- if block.settings.showroom_1_name != blank -%}
                          <div class="showroom-item">
                              <a href="{{ block.settings.showroom_1_map_link }}" target="_blank" rel="noopener" class="showroom-address">
                                <strong>{{ block.settings.showroom_1_name }}</strong><br>
                                {{ block.settings.showroom_1_address }}
                              </a>
                              <a class="phone-link" href="tel:{{ block.settings.showroom_1_phone | remove: ' ' }}">{{ block.settings.showroom_1_phone }}</a>
                          </div>
                          {%- endif -%}
                          {%- if block.settings.showroom_2_name != blank -%}
                          <div class="showroom-item">
                              <a href="{{ block.settings.showroom_2_map_link }}" target="_blank" rel="noopener" class="showroom-address">
                                <strong>{{ block.settings.showroom_2_name }}</strong><br>
                                {{ block.settings.showroom_2_address }}
                            </a>
                              <a class="phone-link" href="tel:{{ block.settings.showroom_2_phone | remove: ' ' }}">{{ block.settings.showroom_2_phone }}</a>
                          </div>
                          {%- endif -%}
                          {%- if block.settings.showroom_3_name != blank -%}
                          <div class="showroom-item">
                              <a href="{{ block.settings.showroom_3_map_link }}" target="_blank" rel="noopener" class="showroom-address">
                                <strong>{{ block.settings.showroom_3_name }}</strong><br>
                                {{ block.settings.showroom_3_address }}
                            </a>
                              <a class="phone-link" href="tel:{{ block.settings.showroom_3_phone | remove: ' ' }}">{{ block.settings.showroom_3_phone }}</a>
                          </div>
                          {%- endif -%}
                        </div>
                      </div>
                    </details>
                  {%- when 'separator' -%}
                    <div class="product-block" {{ block.shopify_attributes }}><hr></div>
                  {%- when 'text' -%}
                    <div class="product-block" {{ block.shopify_attributes }}>
                      {{ block.settings.text }}
                    </div>

                  {%- when 'tab' -%}
                    {% capture tab_content %}
                      {{ block.settings.content }}
                      {{ block.settings.page.content }}
                      {% if block.settings.image != blank %}
                        <img src="{{ block.settings.image | img_url: 'master' }}" loading="lazy" alt="{{ block.settings.image.alt | default: block.settings.title }}" width="{{ block.settings.image.width }}" height="{{ block.settings.image.height }}">
                      {% endif %}
                    {% endcapture %}
                    {% unless tab_content == blank and block.settings.title == blank %}
                      <details class="product-accordion" {{ block.shopify_attributes }}>
                        <summary>
                          <span>{{ block.settings.title }}</span>
                           <svg class="icon-toggle" width="18" height="10" viewBox="0 0 18 10" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1 1.5L9 8.5L17 1.5" stroke="#1C2C58" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        </summary>
                        <div class="product-accordion-content rte">
                          {{ tab_content }}
                      </div>
                      </details>
                    {% endunless %}
                  {%- when 'service_carousel' -%}
                    {%- liquid
                      assign services_count = 0
                      for i in (1..4)
                        assign icon_setting = 'icon_' | append: i
                        assign text_setting = 'text_' | append: i
                        if block.settings[icon_setting] != blank or block.settings[text_setting] != blank
                          assign services_count = services_count | plus: 1
                        endif
                      endfor

                      assign show_nav_buttons = true

                      assign autoplay_duration = false
                      if block.settings.autoplay and services_count > 1
                        assign autoplay_duration = block.settings.delay | times: 1000
                      endif
                    -%}
                    <div class="product-block product-block--service-carousel" {{ block.shopify_attributes }}>
                      <div class="service-carousel-wrapper">
                        <div class="service-carousel" 
                          data-flickity='{ 
                            "cellAlign": "left",
                            "contain": true,
                            "prevNextButtons": {{ show_nav_buttons }},
                            "pageDots": false,
                            "wrapAround": true,
                            "autoPlay": {{ autoplay_duration }}
                          }'>
                          {%- for i in (1..4) -%}
                            {%- liquid
                              assign icon_setting = 'icon_' | append: i
                              assign text_setting = 'text_' | append: i
                              assign icon = block.settings[icon_setting]
                              assign text = block.settings[text_setting]
                            -%}
                            {%- if icon != blank or text != blank -%}
                              <div class="service-carousel-cell">
                                <div class="service-block">
                                  {%- if icon != blank -%}
                                    <div class="service-block__icon">
                                      <img src="{{ icon | img_url: 'master' }}" alt="{{ icon.alt | default: text }}" width="69" height="53">
                                    </div>
                                  {%- endif -%}
                                  {%- if text != blank -%}
                                    <div class="service-block__text">
                                      <p>{{ text }}</p>
                                    </div>
                                  {%- endif -%}
                                </div>
                              </div>
                            {%- endif -%}
                          {%- endfor -%}
                        </div>
                      </div>
                    </div>
                  {%- when 'productbundle' -%}
                    <div class="product-block product-block-bundle" {{ block.shopunlessy_attributes }}>
                      {% render 'product-bundle',
                        bundleProduct: block.settings.product_list,
                        block: block,
                        title: block.settings.cross_sell_title,
                        label_sale: block.settings.cross_sell_label
                      %}
                    </div>
                  {%- when 'contact' -%}
                    <div class="product-block product-block--tab" {{ block.shopify_attributes }}>
                      {% assign tab_id = block.id | append: product.id %}
                      {%- render 'tab-contact', id: tab_id, block: block -%}
                    </div>
                  {%- when 'description' -%}
                     <details class="product-accordion product-accordion--styled" open {{ block.shopify_attributes }}>
                        <summary>
                          <span>{{ 'products.product.description' | t }}</span>
                           <svg class="icon-toggle" width="18" height="10" viewBox="0 0 18 10" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1 1.5L9 8.5L17 1.5" stroke="#1C2C58" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        </summary>
                        <div class="product-accordion-content rte">
                          {{ product.description }}
                        </div>
                      </details>
                  {%- when 'usage_guide' -%}
                    {%- capture usage_content -%}
                      {%- if block.settings.image != blank -%}
                        <img src="{{ block.settings.image | img_url: 'master' }}" loading="lazy" alt="{{ block.settings.image.alt | default: block.settings.title }}" width="{{ block.settings.image.width }}" height="{{ block.settings.image.height }}">
                      {%- endif -%}
                      {{ block.settings.content }}
                    {%- endcapture -%}
                    {%- unless usage_content == blank and block.settings.title == blank -%}
                      <details class="product-accordion product-accordion--styled" {{ block.shopify_attributes }}>
                        <summary>
                          <span>{{ block.settings.title }}</span>
                          <svg class="icon-toggle" width="18" height="10" viewBox="0 0 18 10" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1 1.5L9 8.5L17 1.5" stroke="#1C2C58" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        </summary>
                        <div class="product-accordion-content rte">
                          {{ usage_content }}
                        </div>
                      </details>
                    {%- endunless -%}
                  {%- when 'size_guide_dropdown' -%}
                    <div class="product-block" {{ block.shopify_attributes }}>
                      <div class="size-guide-text-dropdown-container">
                        <style>
                          .size-guide-text-dropdown-container {
                            border-radius: 5px;
                            background: #F5F9FF;
                            max-width: 646px;
                            flex-shrink: 0;
                            margin-bottom: 16px;
                          }
                      
                          .size-guide-text-trigger {
                            background: none;
                            border: none;
                            padding: 0 20px;
                            width: 100%;
                            min-height: 60px;
                            
                            font-family: "Be Vietnam Pro", sans-serif;
                            font-weight: 600;
                            font-size: 16px;
                            line-height: 22px;
                            color: #1C2C58;
                            text-decoration: none;
                            cursor: pointer;
                            
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            gap: 8px;
                            text-align: left;
                          }
                      
                          .size-guide-text-trigger .arrow-icon {
                            transition: transform 0.3s ease-out;
                            flex-shrink: 0;
                          }
                      
                          .size-guide-text-trigger.is-active .arrow-icon {
                            transform: rotate(180deg);
                          }
                      
                          .size-guide-content {
                            max-height: 0;
                            overflow: hidden;
                            transition: max-height 0.4s ease-out, padding 0.4s ease-out;
                            padding: 0 20px;
                          }
                      
                          .size-guide-content.is-active {
                            max-height: 1000px; /* Adjust if your image is taller */
                            padding: 0 20px 20px;
                          }
                      
                          .size-guide-content img {
                            display: block;
                            width: 100%;
                            height: auto;
                            border-radius: 4px;
                          }
                        </style>
                      
                        <button class="size-guide-text-trigger">
                          <span>{{ block.settings.title | escape }}</span>
                          <span class="arrow-icon">
                            <svg width="18" height="10" viewBox="0 0 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                              <path d="M1 1.5L9 8.5L17 1.5" stroke="#1C2C58" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                          </span>
                        </button>
                      
                        <div class="size-guide-content">
                          {%- if block.settings.image != blank -%}
                            <img src="{{ block.settings.image | img_url: 'master' }}"
                                 alt="{{ block.settings.image.alt | default: block.settings.title | escape }}"
                                 width="{{ block.settings.image.width }}"
                                 height="{{ block.settings.image.height }}"
                                 loading="lazy">
                          {%- else -%}
                            {{ 'image' | placeholder_svg_tag: 'placeholder-svg' }}
                          {%- endif -%}
                        </div>
                      
                        <script>
                          (function() {
                            const container = document.currentScript.parentElement;
                            const trigger = container.querySelector('.size-guide-text-trigger');
                            const content = container.querySelector('.size-guide-content');
                          
                            if (trigger && content) {
                              trigger.addEventListener('click', function() {
                                this.classList.toggle('is-active');
                                content.classList.toggle('is-active');
                              });
                            }
                          })();
                        </script>
                      </div>
                    </div>
                  {%- when 'price' -%}
                    <div class="product-block product-block--price" {{ block.shopify_attributes }}>
                      <div class="price-container-wrapper">
                        {%- assign hide_sale_price = true -%}
                        {%- if product.compare_at_price_max > product.price -%}
                          {%- if current_variant.compare_at_price > current_variant.price -%}
                            {%- assign hide_sale_price = false -%}
                          {%- endif -%}
                          <span
                            data-a11y-price
                            class="visually-hidden"
                            aria-hidden="{{ hide_sale_price }}"
                          >
                            {{ 'products.general.regular_price' | t }}
                          </span>
                          <span
                            data-product-price
                            data-product-price-base="{{ current_variant.price }}"
                            class="product__price text-2xl f-smb{% if current_variant.compare_at_price > current_variant.price %} on-sale{% endif %}"
                          >
                            {%- unless product.empty? -%}
                              {{ current_variant.price | money }}
                            {%- else -%}
                              {{ 1999 | money }}
                            {%- endunless -%}
                          </span>
  
                          <span data-product-price-wrap>
                            <span
                              data-compare-price
                              class="product__price product__price--compare text-xl"
                            >
                              {%- if current_variant.compare_at_price > current_variant.price -%}
                                {{ current_variant.compare_at_price | money }}
                              {%- endif -%}
                            </span>
                          </span>
                          <span data-compare-price-a11y class="visually-hidden">
                            {{- 'products.general.sale_price' | t -}}
                          </span>
  
                        {%- else -%}
                          <span
                            data-product-price
                            data-product-price-base="{{ current_variant.price }}"
                            class="product__price text-2xl f-smb{% if current_variant.compare_at_price > current_variant.price %} on-sale{% endif %}"
                          >
                            {%- unless product.empty? -%}
                              {{ current_variant.price | money }}
                            {%- else -%}
                              {{ 1999 | money }}
                            {%- endunless -%}
                          </span>
                          <span data-a11y-price class="visually-hidden">
                            {{- 'products.general.regular_price' | t -}}
                          </span>
                        {%- endif -%}
  
                        {%- if current_variant.compare_at_price > current_variant.price -%}
                          {%- capture discount_percentage -%}{{ current_variant.compare_at_price | minus: current_variant.price | times: 100.0 | divided_by: current_variant.compare_at_price | round }}{%- endcapture -%}
                          <div class="product__discount-badge">-{{ discount_percentage }}%</div>
                        {%- endif -%}
                      </div>

                      {%- if settings.product_save_amount -%}
                        {%- if settings.product_save_type == 'dollar' -%}
                          {%- capture saved_amount -%}{{ current_variant.compare_at_price | minus: current_variant.price | money }}{%- endcapture -%}
                        {%- else -%}
                          {%- capture saved_amount -%}{{ current_variant.compare_at_price | minus: current_variant.price | times: 100.0 | divided_by: current_variant.compare_at_price | round }}%{%- endcapture -%}
                        {%- endif -%}
                        <span data-save-price class="product__price-savings text-xl">
                          {{ saved_amount }}
                          <span class="save_amount_minus hide">
                            {%- unless hide_sale_price -%}
                              {{ 'products.general.save_html' | t: saved_amount: saved_amount }}
                            {%- endunless -%}
                          </span>
                        </span>
                      {%- endif -%}

                      <div
                        data-unit-price-wrapper
                        class="product__unit-price product__unit-price--spacing {% unless current_variant.unit_price_measurement %} hide{% endunless %}"
                      >
                        {%- capture unit_price_base_unit -%}
                            <span data-unit-base>
                              {%- if current_variant.unit_price_measurement -%}
                                {%- if current_variant.unit_price_measurement.reference_value != 1 -%}
                                  {{ current_variant.unit_price_measurement.reference_value }}
                                {%- endif -%}
                                {{ current_variant.unit_price_measurement.reference_unit }}
                              {%- endif -%}
                            </span>
                          {%- endcapture -%}

                        <span data-unit-price>{{ current_variant.unit_price | money }}</span>/
                        {{- unit_price_base_unit }}
                      </div>

                      {% comment %} {%- if shop.taxes_included or shop.shipping_policy.body != blank -%}
                        <div class="product__policies rte">
                          {%- if shop.taxes_included -%}
                            {{ 'products.product.include_taxes' | t }}
                          {%- endif -%}
                          {%- if shop.shipping_policy.body != blank -%}
                            {{ 'products.product.shipping_policy_html' | t: link: shop.shipping_policy.url }}
                          {%- endif -%}
                        </div>
                      {%- endif -%} {% endcomment %}
                    </div>
                  {%- when 'quantity_selector' -%}
                    <div class="product-block" {{ block.shopify_attributes }}>
                      <div class="product__quantity">
                        {% assign qty_id = section_id | append: product.id %}
                        <label for="Quantity-{{ qty_id }}">{{ 'products.product.quantity' | t }}</label>
                        {%- render 'quantity-input', form_id: form_id, id: qty_id, qty: 1, min: 1 -%}
                      </div>
                    </div>
                  {%- when 'size_chart' -%}
                    {% if connect_to_sizechart == false %}
                      {%- capture size_chart_title -%}
                        {{ 'products.general.size_chart' | t }}<svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-size-chart" viewBox="0 0 64 64"><path d="M22.39 33.53c-7.46 0-13.5-3.9-13.5-8.72s6-8.72 13.5-8.72 13.5 3.9 13.5 8.72a12 12 0 0 1-.22 1.73"/><ellipse cx="22.39" cy="24.81" rx="3.28" ry="2.12"/><path d="M8.89 24.81V38.5c0 7.9 6.4 9.41 14.3 9.41h31.92V33.53H22.39m24.39 0v7.44m-8.13-7.44v7.44m-8.13-7.44v7.44"/></svg>
                      {%- endcapture -%}

                      <div class="size-chart__standalone" {{ block.shopify_attributes }}>
                        {%- render 'tool-tip-trigger',
                          title: size_chart_title,
                          content: block.settings.size_chart.content,
                          context: 'size-chart'
                        -%}
                        {% style %}
                          tool-tip-trigger {
                            text-transform: uppercase;
                          }
                        {% endstyle %}
                      </div>
                    {% endif %}
                  {%- when 'variant_picker' -%}
                    <div
                      class="product-block"
                      {% if block.settings.product_dynamic_variants_enable %}
                        data-dynamic-variants-enabled
                      {% endif %}
                      {{ block.shopify_attributes }}
                    >
                      {%- unless product.has_only_default_variant -%}
                        {%- for option in product.options_with_values -%}
                          {%- liquid
                            if block.settings.color_swatches
                              assign is_color = false
                              assign color_option_index = 0
                              assign swatch_trigger = 'products.general.color_swatch_trigger' | t | downcase
                              assign color_option_index = forloop.index0
                              assign downcased_option = option.name | downcase
                              if downcased_option contains swatch_trigger
                                assign is_color = true
                              elsif swatch_trigger == 'color' and downcased_option contains 'colour'
                                assign is_color = true
                              endif
                            endif
                          -%}
                          
                          {%- if block.settings.picker_type == 'button' -%}
                            {%- render 'variant-button',
                              block: block,
                              product: product,
                              form_id: form_id,
                              section_id: section_id,
                              option: option,
                              forloop: forloop,
                              variant_labels: block.settings.variant_labels,
                              is_color: is_color,
                              color_option_index: color_option_index,
                              connect_to_sizechart: connect_to_sizechart,
                              sizechart_index: sizechart_index
                            -%}
                          {%- else -%}
                            {%- render 'variant-dropdown',
                              product: product,
                              form_id: form_id,
                              section_id: section_id,
                              option: option,
                              forloop: forloop,
                              variant_labels: block.settings.variant_labels
                            -%}
                          {%- endif -%}
                        {%- endfor -%}
                      {%- endunless -%}
                    </div>

                  {%- when 'buy_buttons' -%}
                    <div class="product-block" {{ block.shopify_attributes }}>
                      {%- unless product.empty? -%}
                        <div class="product-block">
                          {%- render 'product-form',
                            form_id: form_id,
                            product: product,
                            show_dynamic_checkout: block.settings.show_dynamic_checkout,
                            current_variant: current_variant,
                            block: block,
                            hide_payment_button_mobile: hide_payment_button_mobile
                          -%}
                        </div>
                      {%- endunless -%}

                      {%- if block.settings.surface_pickup_enable -%}
                        <div
                          data-store-availability-holder
                          data-product-name="{{ product.title | escape }}"
                          data-base-url="{{ shop.url }}{{ routes.root_url }}"
                        ></div>
                      {%- endif -%}
                    </div>
                  {%- when 'sales_point' -%}
                    {%- unless block.settings.text == blank -%}
                      <div class="product-block product-block--sales-point" {{ block.shopify_attributes }}>
                        <ul class="sales-points">
                          <li class="sales-point">
                            <span class="icon-and-text">
                              {% case block.settings.icon %}
                                {% when 'checkmark' %}
                                  <svg
                                    aria-hidden="true"
                                    focusable="false"
                                    role="presentation"
                                    class="icon icon-circle-checkmark"
                                    viewBox="0 0 64 64"
                                  >
                                    <path d="M52.68 24.48A22 22 0 1 1 47 15.93"/><path d="m21 32 8.5 8.5L57 13"/>
                                  </svg>
                                {% when 'gift' %}
                                  <svg
                                    aria-hidden="true"
                                    focusable="false"
                                    role="presentation"
                                    class="icon icon-gift"
                                    viewBox="0 0 64 64"
                                  >
                                    <path d="M9 20.23h46v8.68H9zm4.34 8.68h36.89v24.3H13.34zm14.48-8.25v32.98m8.09-32.76v32.98M20.52 11.43a3.73 3.73 0 0 0-.74 2.87 4.57 4.57 0 0 0 .8 2.27C22 18.09 25.15 20 32 20.23a12 12 0 0 0-2.43-7 7.52 7.52 0 0 0-5.66-3.12 4 4 0 0 0-3.39 1.32Z"/><path d="M43.37 11.43a3.73 3.73 0 0 1 .74 2.87 4.48 4.48 0 0 1-.8 2.27c-1.42 1.52-4.57 3.41-11.42 3.66a12.08 12.08 0 0 1 2.43-7A7.56 7.56 0 0 1 40 10.14a4 4 0 0 1 3.37 1.29Z"/>
                                  </svg>
                                {% when 'globe' %}
                                  <svg
                                    aria-hidden="true"
                                    focusable="false"
                                    role="presentation"
                                    class="icon icon-globe"
                                    viewBox="0 0 64 64"
                                  >
                                    <circle cx="32" cy="32" r="22"/><path d="M13 21h38M10 32h44M13 43h38M32 10c-12 8-12 37 0 44m0-44c12 8 12 37 0 44"/>
                                  </svg>
                                {% when 'heart' %}
                                  <svg
                                    aria-hidden="true"
                                    focusable="false"
                                    role="presentation"
                                    class="icon icon-heart"
                                    viewBox="0 0 64 64"
                                  >
                                    <path d="M51.27 15.05a13 13 0 0 0-18.44 0l-.83.83-.83-.83a13 13 0 0 0-18.44 18.44l.83.83L32 52.77l18.44-18.45.83-.83a13 13 0 0 0 0-18.44Z"/>
                                  </svg>
                                {% when 'leaf' %}
                                  <svg
                                    aria-hidden="true"
                                    focusable="false"
                                    role="presentation"
                                    class="icon icon-leaf"
                                    viewBox="0 0 64 64"
                                  >
                                    <defs><style>.a{stroke-miterlimit:10}</style></defs><path class="a" d="M52 11 13 50m22-37v15h16"/><path class="a" d="M52 11c6 24-16.72 47.29-33 32C7 22 29 10 52 11Z"/>
                                  </svg>
                                {% when 'lock' %}
                                  <svg
                                    aria-hidden="true"
                                    focusable="false"
                                    role="presentation"
                                    class="icon icon-lock"
                                    viewBox="0 0 64 64"
                                  >
                                    <path d="M19.45 23.6v-3.2c0-7 5.89-11.75 12.55-11.75 7.21 0 12.55 5.49 12.55 11.75v3.2M10 23.6h44v31.75H10zm22 13.87v7.47"/><circle cx="32" cy="35.87" r="1.6"/>
                                  </svg>
                                {% when 'package' %}
                                  <svg
                                    aria-hidden="true"
                                    focusable="false"
                                    role="presentation"
                                    class="icon icon-package"
                                    viewBox="0 0 64 64"
                                  >
                                    <path d="M32 54.52 10 41.95v-19.9L32 9.48l22 12.57v19.9L32 54.52z"/><path d="M32 54.52v-19.9l22-12.57M32 34.62 10 22.05m31.7-7.03L21 28.33v8.38"/>
                                  </svg>
                                {% when 'phone' %}
                                  <svg
                                    aria-hidden="true"
                                    focusable="false"
                                    role="presentation"
                                    class="icon icon-phone"
                                    viewBox="0 0 64 64"
                                  >
                                    <path d="m18.4 9.65 10.2 10.2-6.32 6.32c2.1 7 6.89 12.46 15.55 15.55l6.32-6.32 10.2 10.2-8.75 8.75C25.71 50.3 13.83 38.21 9.65 18.4Z"/>
                                  </svg>
                                {% when 'ribbon' %}
                                  <svg
                                    aria-hidden="true"
                                    focusable="false"
                                    role="presentation"
                                    class="icon icon-ribbon"
                                    viewBox="0 0 64 64"
                                  >
                                    <path d="m28.57 42.31-8.36 13.07-2.6-7.17-7.61.65 8.35-13.07a17.05 17.05 0 0 0 8.12 5.94 17.3 17.3 0 0 0 1.74.5ZM54 48.86l-7.61-.65-2.61 7.17-8.36-13.07.37-.08a16.4 16.4 0 0 0 1.73-.5 17 17 0 0 0 8.12-5.93Z"/><path d="M49 25.64a16.79 16.79 0 0 1-3.14 9.85 3.55 3.55 0 0 1-.23.31 17 17 0 0 1-8.12 5.93 16.4 16.4 0 0 1-1.73.5l-.37.08a16.74 16.74 0 0 1-3.42.35 16.91 16.91 0 0 1-3.43-.35l-.36-.08a17.3 17.3 0 0 1-1.74-.5 17.05 17.05 0 0 1-8.12-5.94c-.07-.09-.15-.19-.22-.3A16.86 16.86 0 0 1 15 25.64a17 17 0 0 1 34 0Z"/><path d="m36.09 27.78.96 5.63L32 30.75l-5.05 2.66.96-5.63-4.09-3.98 5.65-.82L32 17.86l2.53 5.12 5.64.82-4.08 3.98z"/>
                                  </svg>
                                {% when 'shield' %}
                                  <svg
                                    aria-hidden="true"
                                    focusable="false"
                                    role="presentation"
                                    class="icon icon-shield"
                                    viewBox="0 0 64 64"
                                  >
                                    <path d="M21.18 31.69 28.54 39l15.91-15.88"/><path d="M53 12.54v15.24a31.41 31.41 0 0 1-3.7 14.95A25.46 25.46 0 0 1 32 56a25.46 25.46 0 0 1-17.3-13.27A31.41 31.41 0 0 1 11 27.78V12.54C24.88 13.67 32 8 32 8s7.12 5.67 21 4.54Z"/>
                                  </svg>
                                {% when 'tag' %}
                                  <svg
                                    aria-hidden="true"
                                    focusable="false"
                                    role="presentation"
                                    class="icon icon-tag"
                                    viewBox="0 0 64 64"
                                  >
                                    <path d="m46.69 10.34-10.55.07-25.8 25.8 17.45 17.45 25.8-25.8.07-10.55-6.97-6.97z"/><circle cx="43.95" cy="20.05" r="3.53"/><path d="M14.4 32.15 31.85 49.6"/>
                                  </svg>
                                {% when 'truck' %}
                                  <svg
                                    aria-hidden="true"
                                    focusable="false"
                                    role="presentation"
                                    class="icon icon-truck"
                                    viewBox="0 0 64 64"
                                  >
                                    <defs><style>.a{stroke-miterlimit:10}</style></defs><path class="a" d="M16.5 43.22H6.88V16.5h33.14v26.72H23.94m21.48 0h-5.4V30.4h17.1v12.82h-4.23m4.23-12.82-6.41-8.56H40.02"/><circle class="a" cx="20.24" cy="43.76" r="3.74"/><path class="a" d="M45.42 43.23a3.82 3.82 0 1 1 0 .37v-.37"/>
                                  </svg>
                              {% endcase %}
                              <span>{{ block.settings.text }}</span>
                            </span>
                          </li>
                        </ul>
                      </div>
                    {%- endunless -%}
                  {%- when 'inventory_status' -%}
                    {%- render 'product-inventory', product: product, current_variant: current_variant, block: block -%}
                  {%- when 'share' -%}
                    <div class="product-block" {{ block.shopify_attributes }}>
                      {%- render 'social-sharing',
                        share_title: product.title,
                        share_permalink: product.url,
                        share_image: product
                      -%}
                    </div>
                  {%- when 'complementary_products' -%}
                    <div class="product-block" {{ block.shopify_attributes }}>
                      {%- render 'product-complementary',
                        block: block,
                        product: product,
                        type: 'block',
                        image_style: block.settings.image_style
                      -%}
                    </div>
                  {%- when 'trust_badge' -%}
                    <div class="product-block" {{ block.shopify_attributes }}>
                      <div
                        class="aos-animate"
                        style="max-width: {{ block.settings.trust_image.width }}px; margin: 0 auto;"
                      >
                        <div
                          class="image-wrap"
                          style="height: 0; padding-bottom: {{ 100 | divided_by: block.settings.trust_image.aspect_ratio }}%; border-radius: 8px;"
                        >
                          {%- render 'image-element',
                            img: block.settings.trust_image,
                            widths: '360, 540, 700, 1024',
                            sizeVariable: product_description_width
                          -%}
                        </div>
                      </div>
                    </div>
                  {%- when 'custom' -%}
                    <div class="product-block" {{ block.shopify_attributes }}>
                      {{ block.settings.code }}
                    </div>
                  {%- when 'icon_with_text' -%}
                    <div class="product-block" {{ block.shopify_attributes }}>
                      <div class="product-block__iwt">
                        <div class="product-block__iwt-items flex-grid gap medium-down--jc-center">
                          {%- for index in (1..4) -%}
                            {%- capture icon_text -%}icon_{{ index }}{%- endcapture -%}
                            {%- capture image_icon_text -%}image_icon_{{ index }}{%- endcapture -%}
                            {%- capture title_text -%}title_{{ index }}{%- endcapture -%}

                            {%- liquid
                              assign icon_index = block.settings[icon_text]
                              assign image_icon_index = block.settings[image_icon_text]
                              assign title_index = block.settings[title_text]
                            -%}

                            <div class="product-block__iwt-item flex ai-center gap-sm">
                              <div class="item-icon">
                                {%- if image_icon_index != blank -%}
                                  {%- render 'image-element',
                                    img: image_icon_index,
                                    img_width: image_icon_index.width
                                  -%}
                                {%- else -%}
                                  {% render 'icon-accordion', icon: icon_index %}
                                {%- endif -%}
                              </div>
                              <div class="item-title">
                                <div class="text-sm m-0 f-normal">{{ title_index }}</div>
                              </div>
                            </div>
                          {%- endfor -%}
                        </div>
                      </div>
                    </div>
                  {%- when 'carousel_modal' -%}
                    <div class="product-block" {{ block.shopify_attributes }}>
                      <div class="product-block__modal">
                        <modal-opener data-modal="#PopupModal-{{ block.id }}" class="grid no-wrap ai-start">
                          {% for index in (1..4) %}
                            {%- capture description_index -%}description_{{ index }}{%- endcapture -%}
                            {%- capture image_index -%}picture_{{ index }}{%- endcapture -%}
                            {%- capture title_index -%}title_{{ index }}{%- endcapture -%}
                            {% liquid
                              assign desc = product.metafields.custom.product_features.value[description_index].value
                              assign img = product.metafields.custom.product_features.value[image_index].value
                              assign title = product.metafields.custom.product_features.value[title_index].value
                            %}
                            {%- if img != blank and title != blank -%}
                              <button class="block-modal grid__item block-modal--button t-center">
                                {%- if img != blank -%}
                                  <div class="block-modal--image image-wrap">
                                    {% render 'image-element', img: img, classes: 'rounded-sm-large' %}
                                  </div>
                                {%- endif -%}
                                {%- if title != blank -%}
                                  <div class="block-modal--title text-sm">{{ title }}</div>
                                {%- endif -%}
                              </button>
                            {%- endif -%}
                          {% endfor %}
                        </modal-opener>
                      </div>
                    </div>
                {%- endcase -%}
              {%- else -%}
                <div
                  data-blocks-holder
                  data-url="{{ product.url | within: collection }}"
                  data-template="{{ product.template_suffix }}"
                >
                  <div class="placeholder-content" style="min-height: 86px;"></div>
                </div>
              {%- endfor -%}
            </div>

            {%- unless product.empty? -%}
              <textarea class="hide" aria-label="Product JSON" data-variant-json>
                {{ product.variants | json }}
              </textarea>
              {%- if product.options.size > 1 -%}
                <textarea class="hide" aria-label="Variant JSON" data-current-variant-json>
                  {{ current_variant | json }}
                </textarea>
              {%- endif -%}
            {%- endunless -%}
          </div>
        </div>

        {%- unless image_position == 'left' -%}
          <div class="grid__item {{ product_image_width }} product-single__sticky product-grid__images">
            {%- render 'product-images',
              section_id: section_id,
              product: product,
              product_zoom_enable: section.settings.product_zoom_enable,
              product_zoom_size: product_zoom_size,
              product_carousel_enable: section.settings.product_carousel_enable,
              thumbnail_position: section.settings.thumbnail_position,
              thumbnail_height: section.settings.thumbnail_height,
              thumbnail_arrows: section.settings.thumbnail_arrows,
              mobile_layout: section.settings.mobile_layout,
              blocks: section.blocks
            -%}
            <button class="custom-nav-button custom-nav-prev" aria-label="Previous image">
              <svg width="17" height="9" viewBox="0 0 17 9" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2 1.5L8.5 7.5L15 1.5" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
            <button class="custom-nav-button custom-nav-next" aria-label="Next image">
              <svg width="17" height="9" viewBox="0 0 17 9" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2 1.5L8.5 7.5L15 1.5" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
          </div>
        {%- endunless -%}
      </div>
    </div>
  </div>
  {%- if enable_sticky_add_to_cart -%}
    {{ 'sticky-add-to-cart.css' | asset_url | stylesheet_tag }}
    {% render 'sticky-add-to-cart',
      product: product,
      product_form_id: form_id,
      current_variant: current_variant,
      block: block,
      section_id: section_id,
      section: section
    %}
  {%- endif -%}
</div>

{%- for block in blocks -%}
  {%- case block.type -%}
    {%- when 'promotion' -%}
      {%- for i in (1..4) -%}
        {%- capture voucher_image -%}voucher_image_{{ i }}{%- endcapture -%}
        {%- capture popup_bg -%}popup_bg_{{ i }}{%- endcapture -%}
        {%- capture popup_content -%}popup_content_{{ i }}{%- endcapture -%}

        {%- if block.settings[voucher_image] != blank -%}
          <modal-dialog
            id="PromotionPopup-{{ block.id }}-{{ i }}"
            class="promotion-popup-modal popup-modal fixed top-0 left-0 w-full h-full m-auto"
          >
            <div
              role="dialog"
              aria-modal="true"
              class="popup-modal__content absolute w-full h-auto m-auto"
              tabindex="-1"
              style="{% if block.settings[popup_bg] != blank %}background-image: url('{{ block.settings[popup_bg] | img_url: 'master' }}');{% endif %}"
            >
              <div class="popup-modal__content-info relative mx-auto">
                <button
                  id="ModalClose-{{ block.id }}-{{ i }}"
                  type="button"
                  class="popup-modal__toggle block border-none rounded-circle absolute z-index-3 button--close"
                  aria-label="{{ 'accessibility.close_modal' | t }}"
                >
                  <span class="i__close e-none block relative color-current w-full h-full"></span>
                </button>
                <div class="rte">
                  {{ block.settings[popup_content] }}
                </div>
              </div>
            </div>
          </modal-dialog>
        {%- endif -%}
      {%- endfor -%}
    {%- when 'carousel_modal' -%}
      <modal-dialog
        id="PopupModal-{{ block.id }}"
        class="product-popup-modal popup-modal fixed top-0 left-0 w-full h-full m-auto"
        {{ block.shopify_attributes }}
      >
        <div
          role="dialog"
          aria-label="Dialog Mobal"
          aria-modal="true"
          class="product-popup-modal__content popup-modal__content absolute w-full h-auto m-auto"
          tabindex="-1"
        >
          <div class="product-popup-modal__content-info relative mx-auto popup-modal__content-info">
            <button
              id="ModalClose-{{ block.id }}"
              type="button"
              class="product-popup-modal__toggle popup-modal__toggle block border-none rounded-circle absolute z-index-3 button--close"
              aria-label="{{ 'accessibility.close_modal' | t }}"
            >
              <span class="i__close e-none block relative color-current w-full h-full"></span>
            </button>
            <div class="product-popup-modal__carousel" data-slideshow id="ModalCarousel-{{ block.id }}">
              {% for index in (1..4) %}
                {%- capture description_index -%}description_{{ index }}{%- endcapture -%}
                {%- capture image_index -%}picture_{{ index }}{%- endcapture -%}
                {%- capture title_index -%}title_{{ index }}{%- endcapture -%}
                {% liquid
                  assign desc = product.metafields.custom.product_features.value[description_index].value
                  assign img = product.metafields.custom.product_features.value[image_index].value
                  assign title = product.metafields.custom.product_features.value[title_index].value
                %}
                {%- if img != blank and title != blank -%}
                  <div class="carousel-item">
                    <div class="carousel-item--inner flex gap-x">
                      {%- if img != blank -%}
                        <div class="carousel-item--image shrink-0">
                          {% render 'image-element',
                            img: img,
                            classes: 'rounded-sm-large',
                            img_width: 450,
                            img_height: 450,
                            sizes: '450px'
                          %}
                        </div>
                      {%- endif -%}
                      <div class="carousel-item--contnet">
                        {%- if title != blank -%}
                          <div class="carousel-item--title text-lg f-bold">{{ title }}</div>
                        {%- endif -%}
                        {%- if desc != blank -%}
                          <div class="carousel-item--desc text-sm">{{ desc }}</div>
                        {%- endif -%}
                      </div>
                    </div>
                  </div>
                {%- endif -%}
              {% endfor %}
            </div>
          </div>
        </div>
      </modal-dialog>
  {%- endcase -%}
{%- endfor -%}
<script>
function showFullQ2Address() {
  document.getElementById('q2-address-short').style.display = 'none';
  document.getElementById('q2-address-full').style.display = 'inline';
}
</script>

<style>
.short-address-tooltip {
  position: relative;
  cursor: pointer;
  display: inline-block;
}

.short-address-tooltip .tooltip-content {
  visibility: hidden;
  opacity: 0;
  min-width: 260px;
  max-width: 90vw;
  background: rgba(30, 30, 30, 0.95);
  color: #fff;
  text-align: center;
  border-radius: 22px;
  padding: 14px 22px;
  position: absolute;
  left: 50%;
  top: 120%;
  transform: translateX(-50%) scale(0.98);
  box-shadow: 0
</style>


<script>
/**
 * Advanced Sticky Column Logic ("Koala" style)
 * This script dynamically makes the shorter of the two product columns sticky.
 */
function initAdvancedSticky(productSection) {
  if (!productSection) return;

  const gridContainer = productSection.querySelector('.grid');
  const imageColumn = productSection.querySelector('.product-grid__images');
  const infoColumn = productSection.querySelector('.product-grid__info');
  const infoColumnInner = infoColumn ? infoColumn.querySelector('.product-info-inner') : null;
  const imageColumnInner = imageColumn ? imageColumn.querySelector('.product-column-content') : null;
  const interactiveElements = productSection.querySelectorAll('details.product-accordion, .size-guide-text-trigger');

  if (!gridContainer || !imageColumn || !infoColumn || !infoColumnInner || !imageColumnInner) {
    return;
  }

  let scrollHandler = () => {};
  
  const setupStickyColumns = () => {
    // Clean up styles from previous calculations before re-running
    window.removeEventListener('scroll', scrollHandler);
    imageColumnInner.style.cssText = '';
    infoColumnInner.style.cssText = '';
    imageColumn.style.height = '';
    infoColumn.style.height = '';
    imageColumn.style.position = '';
    infoColumn.style.position = '';

    // This logic is for desktop viewports only
    if (window.innerWidth < 991) {
      return;
    }

    requestAnimationFrame(() => {
        // Measure the inner content elements, not the grid containers which are equal height.
        const imageColHeight = imageColumnInner.offsetHeight;
        const infoColHeight = infoColumnInner.offsetHeight;
            
        // Exit if columns are of similar height, as no sticky effect is needed.
        if (Math.abs(imageColHeight - infoColHeight) < 100) {
            return;
        }

        const shortCol = imageColHeight > infoColHeight ? infoColumn : imageColumn;
        const shortColInner = imageColHeight > infoColHeight ? infoColumnInner : imageColumnInner;
        
        // **FIX**: Set position relative on the container of the element that will be docked.
        // This makes it the positioning context for its absolutely positioned child.
        shortCol.style.position = 'relative';
        // Set an explicit height on the short column's container to prevent the grid from collapsing
        // when its inner element is taken out of the document flow with `position: fixed`.
        shortCol.style.height = `${shortCol.offsetHeight}px`;

        const headerOffset = 120; // Adjust if your sticky header's height changes

        scrollHandler = () => {
            const scrollY = window.scrollY;
            const gridRect = gridContainer.getBoundingClientRect();
            const shortColInnerHeight = shortColInner.offsetHeight;
            const gridAbsoluteTop = gridRect.top + scrollY;
            const startPoint = gridAbsoluteTop - headerOffset;
            const stopPoint = gridAbsoluteTop + gridRect.height - shortColInnerHeight - headerOffset;
            const buffer = 2; // A small buffer to prevent jittering at the thresholds
            
            if (scrollY > startPoint + buffer && scrollY < stopPoint - buffer) {
                // State 1: STICKY. The element is fixed relative to the viewport.
                shortColInner.style.position = 'fixed';
                shortColInner.style.top = `${headerOffset}px`;
                shortColInner.style.bottom = 'auto';
                shortColInner.style.width = `${shortCol.offsetWidth}px`;
            } else if (scrollY >= stopPoint - buffer) {
                // State 2: DOCKED. The element is positioned absolutely to the bottom of its parent container.
                shortColInner.style.position = 'absolute';
                shortColInner.style.top = 'auto';
                shortColInner.style.bottom = '0px';
                shortColInner.style.width = '100%';
            } else {
                // State 3: DEFAULT. The element is in its normal static position.
                shortColInner.style.position = '';
                shortColInner.style.top = '';
                shortColInner.style.bottom = '';
                shortColInner.style.width = '';
            }
        };
        
        window.addEventListener('scroll', scrollHandler, { passive: true });
        scrollHandler(); // Run once immediately on setup to get the initial state right
    });
  };
  
  const debounce = (func, delay) => {
      let timeout;
      return function(...args) {
          clearTimeout(timeout);
          timeout = setTimeout(() => func.apply(this, args), delay);
      };
  };

  const debouncedSetup = debounce(setupStickyColumns, 250);

  // --- Event Listeners ---

  // Run on initial load when all assets are ready
  window.addEventListener('load', debouncedSetup);
  // A fallback for DOMContentLoaded in case `load` is slow, e.g., with deferred scripts
  document.addEventListener('DOMContentLoaded', () => setTimeout(debouncedSetup, 500));
  
  // Re-run when the browser is resized
  window.addEventListener('resize', debouncedSetup);

  // Re-run whenever an interactive element (accordion/dropdown) is toggled
  interactiveElements.forEach(el => {
    const eventName = el.tagName.toLowerCase() === 'details' ? 'toggle' : 'click';
    el.addEventListener(eventName, debouncedSetup);
  });
}

// Initialize the script for the current section
const currentProductSection = document.querySelector('#ProductSection-{{ section_id }}-{{ product.id }}');
if (currentProductSection) {
  initAdvancedSticky(currentProductSection);
}

// Re-initialize if the section is reloaded by the theme editor
document.addEventListener('shopify:section:load', function(event) {
  if (event.detail.sectionId === '{{ section_id }}') {
    const reloadedSection = document.querySelector('#ProductSection-{{ section_id }}-{{ product.id }}');
    if (reloadedSection) {
      initAdvancedSticky(reloadedSection);
    }
  }
});
</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const productSections = document.querySelectorAll('.product-section');
  
  productSections.forEach(function(productSection) {
    const flickityElement = productSection.querySelector('.product-slideshow');
    const imageGrid = productSection.querySelector('.product-grid__images');

    if (flickityElement && imageGrid) {
      const prevButton = imageGrid.querySelector('.custom-nav-prev');
      const nextButton = imageGrid.querySelector('.custom-nav-next');
      
      if (prevButton && nextButton) {
        setTimeout(function() {
          const flkty = Flickity.data(flickityElement);
          if (flkty) {
            prevButton.addEventListener('click', function(event) {
              event.stopPropagation();
              flkty.previous();
            });
            nextButton.addEventListener('click', function(event) {
              event.stopPropagation();
              flkty.next();
            });
          }
        }, 500);
      }
    }
  });
});
</script>

