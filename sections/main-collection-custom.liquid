{%- liquid
  assign current_filter_size = 0
  for filter in collection.filters
    assign current_filter_size = current_filter_size | plus: filter.active_values.size
  endfor

  if section.settings.section_width != 'page-width'
    if section.settings.section_width == 'full-width'
      assign page_width = '100%'
    endif
    if section.settings.section_width == 'customize_width'
      assign page_width = section.settings.customize_width | plus: 80 | append: 'px'
    endif
  endif
-%}

<div
  class="collection-content collection-content--custom{% if section.settings.enable_sidebar %} enable-sidebar{% endif %}{% if section.settings.enable_sort %} enable-sort{% endif %}"
  data-section-id="{{ section.id }}"
>
  <div id="CollectionAjaxContent">
    <div
      class="page-width"
      style="{% if section.settings.section_width != 'page-width' %}--page-width: {{ page_width }}{% endif %}"
    >
      <div class="grid">
        <div class="grid__item grid__item--sidebar">
          {%- render 'collection-grid-filters',
            collection: collection,
            enable_sidebar: section.settings.enable_sidebar,
            filter_style: section.settings.filter_style,
            collapsed: section.settings.collapsed,
            enable_sort: section.settings.enable_sort,
            enable_collection_count: section.settings.enable_collection_count,
            enable_color_swatches: section.settings.enable_color_swatches,
            enable_swatch_labels: section.settings.enable_swatch_labels
          -%}
        </div>
        <div class="grid__item grid__item--content" id="ProductGridContainer" data-id="{{ section.id }}">
          {%- assign paginate_by = section.settings.per_row | times: section.settings.rows_per_page -%}
          {%- paginate collection.products by paginate_by -%}

          <div class="cc-grid">
            {%- for product in collection.products -%}
              {%- assign featured_image = product.featured_image | default: product.images.first -%}
              {%- assign is_new = false -%}
              {%- assign is_best_seller = false -%}
              {%- assign is_top_rated = false -%}
              
              {%- comment -%} Check product tags for badges {%- endcomment -%}
              {%- for tag in product.tags -%}
                {%- if tag == 'new' or tag == 'New' -%}
                  {%- assign is_new = true -%}
                {%- elsif tag == 'best-seller' or tag == 'Best Seller' -%}
                  {%- assign is_best_seller = true -%}
                {%- elsif tag == 'top-rated' or tag == 'Top rated' -%}
                  {%- assign is_top_rated = true -%}
                {%- endif -%}
              {%- endfor -%}
              
              <div class="cc-card">
                <div class="cc-image-container">
                  <a class="cc-image" href="{{ product.url }}" aria-label="{{ product.title }}">
                    {%- if featured_image -%}
                      <img
                        src="{{ featured_image | image_url: width: 760, height: 568, crop: 'center' }}"
                        srcset="{{ featured_image | image_url: width: 760, height: 568, crop: 'center' }} 2x, {{ featured_image | image_url: width: 380, height: 284, crop: 'center' }} 1x"
                        width="380" height="284" loading="lazy" alt="{{ featured_image.alt | escape }}"
                      >
                    {%- endif -%}
                  </a>
                  
                  {%- comment -%} Product badges {%- endcomment -%}
                  {%- if is_top_rated -%}
                    <div class="cc-badge cc-badge--top-rated">Top rated</div>
                  {%- elsif is_best_seller -%}
                    <div class="cc-badge cc-badge--best-seller">Best Seller</div>
                  {%- elsif is_new -%}
                    <div class="cc-badge cc-badge--new">New</div>
                  {%- endif -%}
                </div>
                
                <div class="cc-content">
                  {%- comment -%} Rating stars {%- endcomment -%}
                  <div class="cc-rating">
                    <div class="cc-stars">
                      <span class="cc-star">★</span>
                      <span class="cc-star">★</span>
                      <span class="cc-star">★</span>
                      <span class="cc-star">★</span>
                      <span class="cc-star">★</span>
                    </div>
                    <span class="cc-rating-text">5.0 (2025 đánh giá)</span>
                  </div>
                  
                  <a class="cc-title" href="{{ product.url }}">{{ product.title }}</a>
                  
                  <div class="cc-description">
                    Demo content Demo content Demo content content Demo content
                  </div>
                  
                  <div class="cc-price-row">
                    <div class="cc-price">
                      {%- if product.compare_at_price > product.price -%}
                        <span class="cc-price__current">Từ {{ product.price | money }}</span>
                        <div class="cc-price__discount">-{{ product.compare_at_price | minus: product.price | times: 100 | divided_by: product.compare_at_price | round: 0 }}%</div>
                      {%- else -%}
                        <span class="cc-price__current">Từ {{ product.price | money }}</span>
                      {%- endif -%}
                    </div>
                  </div>
                  
                  {%- if product.compare_at_price > product.price -%}
                    <div class="cc-compare-price">{{ product.compare_at_price | money }}</div>
                  {%- endif -%}
                  
                  <div class="cc-actions">
                    <button class="cc-buy-now" type="button" onclick="window.location.href='{{ product.url }}'">Thêm vào giỏ hàng</button>
                  </div>
                </div>
              </div>
            {%- endfor -%}
          </div>

          {%- if paginate.pages > 1 -%}
            {%- render 'pagination', paginate: paginate -%}
          {%- endif -%}

          {%- endpaginate -%}
        </div>
      </div>
    </div>
  </div>
</div>

{%- if section.settings.enable_sidebar == false
  or section.settings.filter_style == 'drawer'
  or collection.filters.size == 0
-%}
  {% style %}
    .collection-content--custom .grid__item--sidebar { width: 0; padding: 0; }
    .collection-content--custom .grid__item--content { width: 100%; }
    .collection-content--custom .grid__item--sidebar { position: static; overflow: hidden; }
  {% endstyle %}
{%- endif -%}

<style>
  .cc-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
    gap: 24px;
    padding: 0 0px;
  }
  
  .cc-card {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }
  
  .cc-image-container {
    position: relative;
    width: 380px;
    height: 284px;
    flex-shrink: 0;
    overflow: hidden;
    border-radius: 8px;
  }
  
  .cc-image {
    display: block;
    width: 100%;
    height: 100%;
  }
  
  .cc-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }
  
  .cc-badge {
    position: absolute;
    top: 12px;
    left: 12px;
    padding: 4px 8px;
    border-radius: 6px;
    font-family: "Be Vietnam Pro", sans-serif;
    font-size: 12px;
    font-weight: 600;
    color: #fff;
    z-index: 2;
  }
  
  .cc-badge--top-rated {
    background: #3264E0;
  }
  
  .cc-badge--best-seller {
    background: #234085;
  }
  
  .cc-badge--new {
    background: #234085;
  }
  
  .cc-content {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  
  .cc-rating {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 4px;
  }
  
  .cc-stars {
    display: flex;
    gap: 2px;
  }
  
  .cc-star {
    color: #FFD700;
    font-size: 14px;
  }
  
  .cc-rating-text {
    font-family: "Be Vietnam Pro", sans-serif;
    font-size: 12px;
    color: #666;
  }
  
  .cc-title {
    color: #000;
    font-family: "Be Vietnam Pro", sans-serif;
    font-size: 20px;
    font-style: normal;
    font-weight: 500;
    line-height: 27px; /* 135% */
    letter-spacing: 0.6px;
    text-decoration: none;
    margin-bottom: 4px;
  }
  
  .cc-title:hover {
    color: #3264E0;
  }
  
  .cc-description {
    color: #000;
    font-family: "Be Vietnam Pro", sans-serif;
    font-size: 20px;
    font-style: normal;
    font-weight: 400;
    line-height: 27px; /* 135% */
    letter-spacing: 0.6px;
    margin-bottom: 8px;
  }
  
  .cc-price-row {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 4px;
  }
  
  .cc-price {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .cc-price__current {
    color: #000;
    font-family: "Be Vietnam Pro", sans-serif;
    font-size: 20px;
    font-style: normal;
    font-weight: 600;
    line-height: 27px; /* 135% */
    letter-spacing: 0.6px;
  }
  
  .cc-price__discount {
    background: #FCE390;
    color: #000;
    padding: 2px 6px;
    border-radius: 3px;
    font-family: "Be Vietnam Pro", sans-serif;
    font-size: 20px;
    font-style: normal;
    font-weight: 600;
    line-height: 27px; /* 135% */
    letter-spacing: 0.6px;
  }
  
  .cc-compare-price {
    color: #888;
    font-family: "Be Vietnam Pro", sans-serif;
    font-size: 18px;
    font-style: normal;
    font-weight: 400;
    line-height: 27px; /* 150% */
    letter-spacing: 0.6px;
    text-decoration-line: line-through;
    margin-bottom: 12px;
  }
  
  .cc-actions {
    margin-top: auto;
  }
  
  .cc-buy-now {
    width: 380px;
    height: 40px;
    background: #234085;
    color: #fff;
    border: none;
    border-radius: 20px;
    font-family: "Be Vietnam Pro", sans-serif;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }
  
  .cc-buy-now:hover {
    background: #3264E0;
  }

  @media (max-width: 768px) {
    .cc-grid {
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 16px;
      padding: 0 15px;
    }
    
    .cc-image-container {
      width: 100%;
      height: 180px;
    }
    
    .cc-content {
      padding: 12px;
    }
    
    .cc-title {
      font-size: 16px;
    }
    
    .cc-description {
      font-size: 13px;
    }
    
    .cc-price__current {
      font-size: 15px;
    }
    
    .cc-buy-now {
      height: 36px;
      font-size: 13px;
    }
  }
</style>

{% schema %}
{
  "name": "Coll custom",
  "settings": [
    {
      "type": "select",
      "id": "section_width",
      "options": [
        { "value": "full-width", "label": "Full width" },
        { "value": "page-width", "label": "Page width" },
        { "value": "customize_width", "label": "Custom width" }
      ],
      "default": "page-width",
      "label": "Section width"
    },
    {
      "type": "range",
      "id": "customize_width",
      "min": 1000,
      "max": 1800,
      "step": 10,
      "default": 1800,
      "unit": "px",
      "label": "Custom width"
    },
    { "type": "header", "content": "Filtering & sorting" },
    { "type": "checkbox", "id": "enable_sidebar", "label": "Enable sidebar filters", "default": true },
    { "type": "checkbox", "id": "collapsed", "label": "Collapse filter groups", "default": true },
    { "type": "select", "id": "filter_style", "label": "Filter style", "default": "sidebar", "options": [ { "value": "sidebar", "label": "Sidebar" }, { "value": "drawer", "label": "Drawer" } ] },
    { "type": "checkbox", "id": "enable_color_swatches", "label": "Enable color swatches" },
    { "type": "checkbox", "id": "enable_swatch_labels", "label": "Show swatch labels", "default": true },
    { "type": "checkbox", "id": "enable_sort", "label": "Enable sort", "default": true },
    { "type": "checkbox", "id": "enable_collection_count", "label": "Show collection count", "default": true },

    { "type": "header", "content": "Grid" },
    { "type": "range", "id": "per_row", "label": "Products per row (desktop)", "default": 3, "min": 2, "max": 5, "step": 1 },
    { "type": "range", "id": "rows_per_page", "label": "Rows per page", "default": 2, "min": 1, "max": 10, "step": 1 },
    { "type": "header", "content": "Defaults" },
    { "type": "range", "id": "default_sold_count", "label": "Default sold count (fallback)", "min": 0, "max": 1000, "step": 10, "default": 0 }
  ],
  "blocks": [],
  "presets": [
    { "name": "Coll custom", "category": "Collection" }
  ],
  "enabled_on": {
    "templates": ["collection"]
  }
}
{% endschema %}


