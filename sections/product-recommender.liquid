{{ 'product-recommender.css' | asset_url | stylesheet_tag }}

<div class="product-recommender" data-section-id="{{ section.id }}" data-section-type="product-recommender">
  <div class="page-width">
    <div class="product-recommender__banner">
      <div class="product-recommender__banner-content">
        <div class="product-recommender__icon">
          <div class="mattress-stack">
            <div class="mattress-layer mattress-layer--1"></div>
            <div class="mattress-layer mattress-layer--2"></div>
            <div class="mattress-layer mattress-layer--3"></div>
          </div>
        </div>
        <div class="product-recommender__text">
          <h2 class="product-recommender__title">{{ section.settings.title | default: "ƒê√¢u l√† chi·∫øc n·ªám ph√π h·ª£p cho b·∫°n?" }}</h2>
          <p class="product-recommender__description">{{ section.settings.description | default: "C√πng Ru9 kh√°m ph√° v√† ch·ªçn ra chi·∫øc n·ªám d√†nh ri√™ng cho b·∫°n." }}</p>
          <button class="product-recommender__btn" data-recommender-trigger>
            {{ section.settings.button_text | default: "Xem Th√™m" }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Chat Modal -->
  <div class="product-recommender__modal" data-recommender-modal>
    <div class="product-recommender__modal-overlay" data-modal-close></div>
    <div class="product-recommender__modal-content">
      <div class="product-recommender__chat-header">
        <div class="product-recommender__logo">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="currentColor"/>
          </svg>
          <span>{{ section.settings.chat_title | default: "Ru9 Assistant" }}</span>
        </div>
        <button class="product-recommender__close" data-modal-close>
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>

      <div class="product-recommender__chat-body">
        <div class="product-recommender__messages" data-messages></div>
        
        <div class="product-recommender__input-container">
          <div class="product-recommender__input-wrapper">
            <textarea 
              class="product-recommender__input" 
              placeholder="{{ section.settings.input_placeholder | default: 'B·∫°n mu·ªën bi·∫øt g√¨?' }}"
              data-chat-input
              rows="1"></textarea>
            <div class="product-recommender__input-actions">
              <button class="product-recommender__send-btn" data-send-message>
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M22 2L11 13M22 2L15 22L11 13M22 2L2 9L11 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>
          </div>
          
          <div class="product-recommender__suggestions" data-suggestions>
            <div class="product-recommender__suggestion-title">G·ª£i √Ω c√¢u h·ªèi:</div>
            <div class="product-recommender__suggestion-grid">
              {% for block in section.blocks %}
                {% if block.type == 'question' %}
                  <button class="product-recommender__suggestion-btn" 
                          data-suggestion="{{ block.settings.question }}" 
                          data-products="{{ block.settings.recommended_products }}"
                          data-category="{{ block.settings.category }}">
                    {{ block.settings.question }}
                  </button>
                {% endif %}
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const section = document.querySelector('[data-section-id="{{ section.id }}"]');
  const trigger = section.querySelector('[data-recommender-trigger]');
  const modal = section.querySelector('[data-recommender-modal]');
  const closeButtons = section.querySelectorAll('[data-modal-close]');
  const messagesContainer = section.querySelector('[data-messages]');
  const chatInput = section.querySelector('[data-chat-input]');
  const sendButton = section.querySelector('[data-send-message]');
  const suggestions = section.querySelectorAll('[data-suggestion]');
  const suggestionsContainer = section.querySelector('[data-suggestions]');

  // M·ªü modal
  trigger.addEventListener('click', function() {
    modal.classList.add('active');
    document.body.classList.add('modal-open');
    addWelcomeMessage();
  });

  // ƒê√≥ng modal
  closeButtons.forEach(button => {
    button.addEventListener('click', function() {
      modal.classList.remove('active');
      document.body.classList.remove('modal-open');
    });
  });

  // G·ª≠i tin nh·∫Øn
  function sendMessage() {
    const message = chatInput.value.trim();
    if (message) {
      addUserMessage(message);
      chatInput.value = '';
      adjustTextareaHeight();
      
      // T√¨m ki·∫øm c√¢u tr·∫£ l·ªùi ph√π h·ª£p
      setTimeout(() => {
        handleBotResponse(message);
      }, 500);
    }
  }

  sendButton.addEventListener('click', sendMessage);
  
  chatInput.addEventListener('keydown', function(e) {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  });

  // Auto resize textarea
  chatInput.addEventListener('input', adjustTextareaHeight);

  function adjustTextareaHeight() {
    chatInput.style.height = 'auto';
    chatInput.style.height = Math.min(chatInput.scrollHeight, 120) + 'px';
  }

  // X·ª≠ l√Ω g·ª£i √Ω
  suggestions.forEach(suggestion => {
    suggestion.addEventListener('click', function() {
      const question = this.dataset.suggestion;
      const products = this.dataset.products;
      const category = this.dataset.category;
      
      addUserMessage(question);
      suggestionsContainer.style.display = 'none';
      
      setTimeout(() => {
        showProductRecommendation(question, products, category);
      }, 500);
    });
  });

  function addWelcomeMessage() {
    if (messagesContainer.children.length === 0) {
      addBotMessage('{{ section.settings.welcome_message | default: "Xin ch√†o! T√¥i c√≥ th·ªÉ gi√∫p b·∫°n t√¨m chi·∫øc n·ªám ph√π h·ª£p. H√£y ch·ªçn m·ªôt c√¢u h·ªèi ho·∫∑c g√µ c√¢u h·ªèi c·ªßa b·∫°n!" }}');
    }
  }

  function addUserMessage(message) {
    const messageDiv = document.createElement('div');
    messageDiv.className = 'product-recommender__message product-recommender__message--user';
    messageDiv.innerHTML = `
      <div class="product-recommender__message-content">
        <p>${message}</p>
      </div>
    `;
    messagesContainer.appendChild(messageDiv);
    scrollToBottom();
  }

  function addBotMessage(message) {
    const messageDiv = document.createElement('div');
    messageDiv.className = 'product-recommender__message product-recommender__message--bot';
    messageDiv.innerHTML = `
      <div class="product-recommender__message-avatar">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="currentColor"/>
        </svg>
      </div>
      <div class="product-recommender__message-content">
        <p>${message}</p>
      </div>
    `;
    messagesContainer.appendChild(messageDiv);
    scrollToBottom();
  }

  function showProductRecommendation(question, productsString, category) {
    if (!productsString) {
      addBotMessage('Xin l·ªói, t√¥i ch∆∞a c√≥ th√¥ng tin v·ªÅ s·∫£n ph·∫©m ph√π h·ª£p cho c√¢u h·ªèi n√†y. B·∫°n c√≥ th·ªÉ li√™n h·ªá v·ªõi ƒë·ªôi ng≈© t∆∞ v·∫•n ƒë·ªÉ ƒë∆∞·ª£c h·ªó tr·ª£ t·ªët h∆°p.');
      return;
    }

    const productHandles = productsString.split(',').map(h => h.trim()).filter(h => h);
    
    // Th√¥ng tin chi ti·∫øt d·ª±a tr√™n category
    const categoryInfo = getCategoryInfo(category);
    let responseMessage = `${categoryInfo.intro} D·ª±a tr√™n c√¢u h·ªèi "${question}", t√¥i g·ª£i √Ω nh·ªØng s·∫£n ph·∫©m sau:`;
    
    addBotMessage(responseMessage);
    
    if (productHandles.length > 0) {
      // T·∫°o danh s√°ch s·∫£n ph·∫©m
      const productsDiv = document.createElement('div');
      productsDiv.className = 'product-recommender__message product-recommender__message--bot';
      productsDiv.innerHTML = `
        <div class="product-recommender__message-avatar">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="currentColor"/>
          </svg>
        </div>
        <div class="product-recommender__message-content">
          <div class="product-recommender__products">
            ${productHandles.map(handle => `
              <div id="product-${handle}-placeholder">
                <div class="product-card-placeholder">
                  <p>üì¶ ƒêang t·∫£i s·∫£n ph·∫©m...</p>
                </div>
              </div>
            `).join('')}
          </div>
          ${categoryInfo.advice ? `<p style="margin-top: 16px; padding-top: 16px; border-top: 1px solid #444; color: #ccc; font-size: 0.9rem;">${categoryInfo.advice}</p>` : ''}
        </div>
      `;
      
      messagesContainer.appendChild(productsDiv);
      
      // Load th√¥ng tin s·∫£n ph·∫©m th·ª±c t·∫ø
      productHandles.forEach(handle => {
        loadProductInfo(handle);
      });
    }
    
    // G·ª£i √Ω th√™m
    setTimeout(() => {
      addBotMessage('B·∫°n c√≥ mu·ªën t√¨m hi·ªÉu th√™m v·ªÅ lo·∫°i n·ªám kh√°c kh√¥ng? H√£y ch·ªçn c√¢u h·ªèi kh√°c ho·∫∑c li√™n h·ªá v·ªõi ƒë·ªôi ng≈© t∆∞ v·∫•n ƒë·ªÉ ƒë∆∞·ª£c h·ªó tr·ª£ chi ti·∫øt h∆°n!');
      if (suggestionsContainer.style.display === 'none') {
        suggestionsContainer.style.display = 'block';
      }
    }, 1000);
    
    scrollToBottom();
  }

  // H√†m load th√¥ng tin s·∫£n ph·∫©m th·ª±c t·∫ø
  function loadProductInfo(handle) {
    const placeholder = document.getElementById(`product-${handle}-placeholder`);
    if (!placeholder) return;
    
    // G·ªçi API ƒë·ªÉ l·∫•y th√¥ng tin s·∫£n ph·∫©m
    fetch(`/products/${handle}.js`)
      .then(response => {
        if (!response.ok) throw new Error('Product not found');
        return response.json();
      })
      .then(product => {
        // T·∫°o HTML cho s·∫£n ph·∫©m th·ª±c t·∫ø
        const productCard = createProductCard(product);
        placeholder.innerHTML = productCard;
      })
      .catch(error => {
        console.warn(`Could not load product ${handle}:`, error);
        // Hi·ªÉn th·ªã placeholder n·∫øu kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m
        placeholder.innerHTML = `
          <div class="product-card product-card--placeholder">
            <div class="product-card__content">
              <h4 class="product-card__title">üì¶ ${handle.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</h4>
              <p class="product-card__description">S·∫£n ph·∫©m n√†y hi·ªán ch∆∞a c√≥ th√¥ng tin.</p>
              <div class="product-card__actions">
                <a href="/products/${handle}" class="btn btn--secondary btn--small" target="_blank">
                  Xem chi ti·∫øt
                </a>
              </div>
            </div>
          </div>
        `;
      });
  }

  // H√†m t·∫°o HTML cho product card
  function createProductCard(product) {
    const imageHtml = product.featured_image ? `
      <div class="product-card__image">
        <img src="${product.featured_image}" 
             alt="${product.title}" 
             width="200"
             height="200"
             loading="lazy">
      </div>
    ` : '';
    
    const priceHtml = product.price ? `
      <div class="product-card__price">
        ${product.compare_at_price && product.compare_at_price > product.price ? 
          `<span class="product-card__price--sale">${formatMoney(product.price)}</span>
           <span class="product-card__price--compare">${formatMoney(product.compare_at_price)}</span>` :
          `<span class="product-card__price--regular">${formatMoney(product.price)}</span>`
        }
      </div>
    ` : '';
    
    const descriptionHtml = product.description ? `
      <div class="product-card__description">
        ${truncateText(stripHtml(product.description), 80)}
      </div>
    ` : '';
    
    const actionButtons = product.available ? `
      <a href="${product.url}" class="btn btn--primary btn--small" target="_blank">
        Xem chi ti·∫øt
      </a>
      <button class="btn btn--secondary btn--small" onclick="addToCartQuick('${product.variants[0].id}')">
        Th√™m v√†o gi·ªè
      </button>
    ` : `
      <a href="${product.url}" class="btn btn--primary btn--small" target="_blank">
        Xem chi ti·∫øt
      </a>
      <span class="btn btn--disabled btn--small">H·∫øt h√†ng</span>
    `;
    
    return `
      <div class="product-card">
        ${imageHtml}
        <div class="product-card__content">
          <h4 class="product-card__title">${product.title}</h4>
          ${priceHtml}
          ${descriptionHtml}
          <div class="product-card__actions">
            ${actionButtons}
          </div>
        </div>
      </div>
    `;
  }

  // Helper functions
  function formatMoney(cents) {
    return new Intl.NumberFormat('vi-VN', {
      style: 'currency',
      currency: 'VND'
    }).format(cents / 100);
  }
  
  function stripHtml(html) {
    const tmp = document.createElement('div');
    tmp.innerHTML = html;
    return tmp.textContent || tmp.innerText || '';
  }
  
  function truncateText(text, length) {
    if (text.length <= length) return text;
    return text.substr(0, length) + '...';
  }

  // H√†m th√™m s·∫£n ph·∫©m v√†o gi·ªè h√†ng
  function addToCartQuick(variantId) {
    const formData = new FormData();
    formData.append('items[0][id]', variantId);
    formData.append('items[0][quantity]', 1);
    
    fetch('/cart/add.js', {
      method: 'POST',
      body: formData
    })
    .then(response => response.json())
    .then(data => {
      // Hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng
      showNotification('‚úÖ ƒê√£ th√™m s·∫£n ph·∫©m v√†o gi·ªè h√†ng!', 'success');
      
      // C·∫≠p nh·∫≠t cart count n·∫øu c√≥
      if (window.theme && window.theme.cart) {
        window.theme.cart.updateCartCount();
      }
    })
    .catch(error => {
      console.error('Error:', error);
      showNotification('‚ùå C√≥ l·ªói x·∫£y ra khi th√™m s·∫£n ph·∫©m v√†o gi·ªè h√†ng.', 'error');
    });
  }
  
  function showNotification(message, type = 'success') {
    const notification = document.createElement('div');
    notification.className = 'cart-notification';
    notification.innerHTML = message;
    notification.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      background: ${type === 'success' ? '#4ade80' : '#ef4444'};
      color: #fff;
      padding: 12px 20px;
      border-radius: 8px;
      font-weight: 600;
      z-index: 10000;
      animation: slideInRight 0.3s ease;
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
      notification.remove();
    }, 3000);
  }

  // Add global functions to window
  window.addToCartQuick = addToCartQuick;

  function getCategoryInfo(category) {
    const categories = {
      'size': {
        intro: 'üìè K√≠ch th∆∞·ªõc n·ªám r·∫•t quan tr·ªçng cho gi·∫•c ng·ªß tho·∫£i m√°i.',
        advice: 'üí° M·∫πo: Ch·ªçn n·ªám l·ªõn h∆°n k√≠ch th∆∞·ªõc hi·ªán t·∫°i 15-20cm m·ªói b√™n ƒë·ªÉ c√≥ kh√¥ng gian tho·∫£i m√°i h∆°n.'
      },
      'material': {
        intro: 'üß± Ch·∫•t li·ªáu n·ªám quy·∫øt ƒë·ªãnh ƒë·ªô tho·∫£i m√°i v√† ƒë·ªô b·ªÅn.',
        advice: 'üí° M·∫πo: N·ªám foam ph√π h·ª£p v·ªõi ng∆∞·ªùi th√≠ch ƒë·ªô √¥m, n·ªám l√≤ xo t·ªët cho ng∆∞·ªùi ∆∞a ƒë·ªô tho√°ng kh√≠.'
      },
      'budget': {
        intro: 'üí∞ Ch√∫ng t√¥i c√≥ nhi·ªÅu l·ª±a ch·ªçn ph√π h·ª£p v·ªõi ng√¢n s√°ch c·ªßa b·∫°n.',
        advice: 'üí° M·∫πo: ƒê·∫ßu t∆∞ v√†o n·ªám ch·∫•t l∆∞·ª£ng l√† ƒë·∫ßu t∆∞ cho s·ª©c kh·ªèe v√† gi·∫•c ng·ªß c·ªßa b·∫°n.'
      },
      'health': {
        intro: 'üè• S·ª©c kh·ªèe l√† ∆∞u ti√™n h√†ng ƒë·∫ßu khi ch·ªçn n·ªám.',
        advice: 'üí° M·∫πo: N·ªám c√≥ ƒë·ªô c·ª©ng v·ª´a ph·∫£i s·∫Ω h·ªó tr·ª£ t·ªët cho c·ªôt s·ªëng v√† gi·∫£m ƒëau l∆∞ng.'
      },
      'age': {
        intro: 'üë∂ T·ª´ng ƒë·ªô tu·ªïi c√≥ nhu c·∫ßu v·ªÅ n·ªám kh√°c nhau.',
        advice: 'üí° M·∫πo: Tr·∫ª em c·∫ßn n·ªám an to√†n, ng∆∞·ªùi cao tu·ªïi c·∫ßn n·ªám h·ªó tr·ª£ x∆∞∆°ng kh·ªõp t·ªët.'
      },
      'sleeping_position': {
        intro: 'üò¥ T∆∞ th·∫ø ng·ªß ·∫£nh h∆∞·ªüng ƒë·∫øn vi·ªác ch·ªçn ƒë·ªô c·ª©ng c·ªßa n·ªám.',
        advice: 'üí° M·∫πo: Ng·ªß nghi√™ng c·∫ßn n·ªám m·ªÅm h∆°n, ng·ªß ng·ª≠a/s·∫•p c·∫ßn n·ªám c·ª©ng h∆°n.'
      },
      'couple': {
        intro: 'üë´ N·ªám d√†nh cho c·∫∑p ƒë√¥i c·∫ßn c√¢n b·∫±ng nhu c·∫ßu c·ªßa c·∫£ hai.',
        advice: 'üí° M·∫πo: Ch·ªçn n·ªám c√≥ kh·∫£ nƒÉng c√°ch ly chuy·ªÉn ƒë·ªông ƒë·ªÉ kh√¥ng l√†m phi·ªÅn ƒë·ªëi ph∆∞∆°ng.'
      },
      'temperature': {
        intro: 'üå°Ô∏è Kh·∫£ nƒÉng ƒëi·ªÅu h√≤a nhi·ªát ƒë·ªô quan tr·ªçng cho gi·∫•c ng·ªß s√¢u.',
        advice: 'üí° M·∫πo: N·ªám c√≥ gel l√†m m√°t ho·∫∑c c√¥ng ngh·ªá tho√°ng kh√≠ ph√π h·ª£p v·ªõi ng∆∞·ªùi d·ªÖ ra m·ªì h√¥i.'
      }
    };
    
    return categories[category] || {
      intro: '‚ú® C·∫£m ∆°n b·∫°n ƒë√£ quan t√¢m ƒë·∫øn s·∫£n ph·∫©m c·ªßa Ru9.',
      advice: null
    };
  }

  function handleBotResponse(userMessage) {
    // Logic x·ª≠ l√Ω ph·∫£n h·ªìi t·ª± ƒë·ªông d·ª±a tr√™n t·ª´ kh√≥a
    const lowerMessage = userMessage.toLowerCase();
    
    let response = '{{ section.settings.default_response | default: "C·∫£m ∆°n b·∫°n ƒë√£ c√¢u h·ªèi! ƒê·ªÉ c√≥ ƒë∆∞·ª£c t∆∞ v·∫•n ch√≠nh x√°c nh·∫•t, b·∫°n c√≥ th·ªÉ ch·ªçn m·ªôt trong c√°c c√¢u h·ªèi g·ª£i √Ω b√™n d∆∞·ªõi ho·∫∑c li√™n h·ªá tr·ª±c ti·∫øp v·ªõi ƒë·ªôi ng≈© t∆∞ v·∫•n c·ªßa ch√∫ng t√¥i." }}';
    
    // Ki·ªÉm tra t·ª´ kh√≥a v√† ƒë∆∞a ra ph·∫£n h·ªìi ph√π h·ª£p
    if (lowerMessage.includes('size') || lowerMessage.includes('k√≠ch th∆∞·ªõc') || lowerMessage.includes('kich thuoc')) {
      response = 'üìè ƒê·ªÉ ch·ªçn k√≠ch th∆∞·ªõc n·ªám ph√π h·ª£p, b·∫°n c·∫ßn xem x√©t di·ªán t√≠ch ph√≤ng v√† s·ªë ng∆∞·ªùi s·ª≠ d·ª•ng. C√°c k√≠ch th∆∞·ªõc ph·ªï bi·∫øn: ƒë∆°n (1m2), ƒë√¥i (1m6, 1m8, 2m). B·∫°n c√≥ th·ªÉ ch·ªçn c√¢u h·ªèi v·ªÅ k√≠ch th∆∞·ªõc trong danh s√°ch g·ª£i √Ω ƒë·ªÉ ƒë∆∞·ª£c t∆∞ v·∫•n chi ti·∫øt h∆°n.';
    } else if (lowerMessage.includes('gi√°') || lowerMessage.includes('price') || lowerMessage.includes('ti·ªÅn')) {
      response = 'üí∞ Gi√° n·ªám c·ªßa Ru9 r·∫•t ƒëa d·∫°ng t·ª´ 2-50 tri·ªáu t√πy theo lo·∫°i v√† k√≠ch th∆∞·ªõc. Ch√∫ng t√¥i c√≥ c√°c d√≤ng s·∫£n ph·∫©m ph√π h·ª£p v·ªõi m·ªçi ng√¢n s√°ch. H√£y cho t√¥i bi·∫øt m·ª©c gi√° b·∫°n quan t√¢m ƒë·ªÉ ƒë∆∞·ª£c t∆∞ v·∫•n ph√π h·ª£p nh·∫•t.';
    } else if (lowerMessage.includes('ch·∫•t li·ªáu') || lowerMessage.includes('material') || lowerMessage.includes('foam') || lowerMessage.includes('l√≤ xo')) {
      response = 'üß± Ru9 c√≥ nhi·ªÅu lo·∫°i n·ªám v·ªõi ch·∫•t li·ªáu kh√°c nhau: Foam (√¥m body, gi·∫£m √°p l·ª±c), L√≤ xo t√∫i (tho√°ng kh√≠, h·ªó tr·ª£ t·ªët), Latex (kh√°ng khu·∫©n, ƒë√†n h·ªìi cao). M·ªói lo·∫°i c√≥ ∆∞u ƒëi·ªÉm ri√™ng ph√π h·ª£p v·ªõi nhu c·∫ßu kh√°c nhau.';
    } else if (lowerMessage.includes('ƒëau l∆∞ng') || lowerMessage.includes('dau lung') || lowerMessage.includes('s·ª©c kh·ªèe') || lowerMessage.includes('suc khoe')) {
      response = 'üè• ƒê·ªëi v·ªõi ng∆∞·ªùi b·ªã ƒëau l∆∞ng, t√¥i khuy√™n n√™n ch·ªçn n·ªám c√≥ ƒë·ªô c·ª©ng v·ª´a ph·∫£i, h·ªó tr·ª£ c·ªôt s·ªëng t·ª± nhi√™n. N·ªám l√≤ xo t√∫i ho·∫∑c foam m·∫≠t ƒë·ªô cao s·∫Ω ph√π h·ª£p. B·∫°n c√≥ th·ªÉ ch·ªçn c√¢u h·ªèi v·ªÅ s·ª©c kh·ªèe ƒë·ªÉ ƒë∆∞·ª£c t∆∞ v·∫•n c·ª• th·ªÉ h∆°n.';
    } else if (lowerMessage.includes('tr·∫ª em') || lowerMessage.includes('tre em') || lowerMessage.includes('baby') || lowerMessage.includes('kid')) {
      response = 'üë∂ N·ªám cho tr·∫ª em c·∫ßn an to√†n, kh√¥ng ƒë·ªôc h·∫°i, c√≥ ƒë·ªô c·ª©ng v·ª´a ph·∫£i ƒë·ªÉ h·ªó tr·ª£ ph√°t tri·ªÉn x∆∞∆°ng kh·ªõp. Ru9 c√≥ d√≤ng s·∫£n ph·∫©m ƒë·∫∑c bi·ªát d√†nh cho tr·∫ª em v·ªõi ch·ª©ng nh·∫≠n an to√†n qu·ªëc t·∫ø.';
    }
    
    addBotMessage(response);
    
    // Hi·ªÉn th·ªã l·∫°i g·ª£i √Ω
    if (suggestionsContainer.style.display === 'none') {
      suggestionsContainer.style.display = 'block';
    }
  }

  function scrollToBottom() {
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
  }
});
</script>

{% schema %}
{
  "name": "Product Recommender",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Ti√™u ƒë·ªÅ",
      "default": "ƒê√¢u l√† chi·∫øc n·ªám ph√π h·ª£p cho b·∫°n?"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "M√¥ t·∫£",
      "default": "C√πng Ru9 kh√°m ph√° v√† ch·ªçn ra chi·∫øc n·ªám d√†nh ri√™ng cho b·∫°n."
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Text n√∫t",
      "default": "Xem Th√™m"
    },
    {
      "type": "text",
      "id": "chat_title",
      "label": "Ti√™u ƒë·ªÅ chat",
      "default": "Ru9 Assistant"
    },
    {
      "type": "textarea",
      "id": "welcome_message",
      "label": "Tin nh·∫Øn ch√†o m·ª´ng",
      "default": "Xin ch√†o! T√¥i c√≥ th·ªÉ gi√∫p b·∫°n t√¨m chi·∫øc n·ªám ph√π h·ª£p. H√£y ch·ªçn m·ªôt c√¢u h·ªèi ho·∫∑c g√µ c√¢u h·ªèi c·ªßa b·∫°n!"
    },
    {
      "type": "text",
      "id": "input_placeholder",
      "label": "Placeholder input",
      "default": "B·∫°n mu·ªën bi·∫øt g√¨?"
    },
    {
      "type": "textarea",
      "id": "default_response",
      "label": "Ph·∫£n h·ªìi m·∫∑c ƒë·ªãnh",
      "default": "C·∫£m ∆°n b·∫°n ƒë√£ c√¢u h·ªèi! ƒê·ªÉ c√≥ ƒë∆∞·ª£c t∆∞ v·∫•n ch√≠nh x√°c nh·∫•t, b·∫°n c√≥ th·ªÉ ch·ªçn m·ªôt trong c√°c c√¢u h·ªèi g·ª£i √Ω b√™n d∆∞·ªõi ho·∫∑c li√™n h·ªá tr·ª±c ti·∫øp v·ªõi ƒë·ªôi ng≈© t∆∞ v·∫•n c·ªßa ch√∫ng t√¥i."
    }
  ],
  "blocks": [
    {
      "type": "question",
      "name": "C√¢u h·ªèi",
      "settings": [
        {
          "type": "text",
          "id": "question",
          "label": "C√¢u h·ªèi",
          "default": "T√¥i mu·ªën t√¨m n·ªám cho gi∆∞·ªùng ƒë√¥i"
        },
        {
          "type": "select",
          "id": "category",
          "label": "Danh m·ª•c",
          "default": "size",
          "options": [
            { "value": "size", "label": "K√≠ch th∆∞·ªõc" },
            { "value": "material", "label": "Ch·∫•t li·ªáu" },
            { "value": "budget", "label": "Ng√¢n s√°ch" },
            { "value": "health", "label": "S·ª©c kh·ªèe" },
            { "value": "age", "label": "ƒê·ªô tu·ªïi" },
            { "value": "sleeping_position", "label": "T∆∞ th·∫ø ng·ªß" },
            { "value": "couple", "label": "C·∫∑p ƒë√¥i" },
            { "value": "temperature", "label": "Nhi·ªát ƒë·ªô" }
          ]
        },
        {
          "type": "text",
          "id": "recommended_products",
          "label": "S·∫£n ph·∫©m g·ª£i √Ω (handle, c√°ch nhau b·ªüi d·∫•u ph·∫©y)",
          "info": "Nh·∫≠p handle c·ªßa c√°c s·∫£n ph·∫©m, v√≠ d·ª•: nem-foam-cao-cap, nem-lo-xo-tui",
          "default": "nem-original-pro"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Product Recommender",
      "blocks": [
        {
          "type": "question",
          "settings": {
            "question": "T√¥i mu·ªën t√¨m n·ªám cho gi∆∞·ªùng ƒë√¥i 1m8",
            "category": "size",
            "recommended_products": "nem-foam-1m8, nem-lo-xo-1m8"
          }
        },
        {
          "type": "question",
          "settings": {
            "question": "N·ªám n√†o ph√π h·ª£p cho ng∆∞·ªùi b·ªã ƒëau l∆∞ng?",
            "category": "health",
            "recommended_products": "nem-ortho-support, nem-medical-foam"
          }
        },
        {
          "type": "question",
          "settings": {
            "question": "T√¥i c√≥ ng√¢n s√°ch d∆∞·ªõi 5 tri·ªáu",
            "category": "budget",
            "recommended_products": "nem-eco-foam, nem-basic-spring"
          }
        },
        {
          "type": "question",
          "settings": {
            "question": "N·ªám ch·∫•t li·ªáu g√¨ t·ªët cho tr·∫ª em?",
            "category": "age",
            "recommended_products": "nem-kids-safe, nem-organic-cotton"
          }
        },
        {
          "type": "question",
          "settings": {
            "question": "T√¥i th√≠ch n·ªám m·ªÅm, √¥m body",
            "category": "material",
            "recommended_products": "nem-memory-foam, nem-gel-foam"
          }
        },
        {
          "type": "question",
          "settings": {
            "question": "N·ªám cho ng∆∞·ªùi ng·ªß nghi√™ng",
            "category": "sleeping_position",
            "recommended_products": "nem-side-sleeper, nem-contour-foam"
          }
        },
        {
          "type": "question",
          "settings": {
            "question": "N·ªám kh√¥ng b·ªã l√∫n khi 2 ng∆∞·ªùi n·∫±m",
            "category": "couple",
            "recommended_products": "nem-pocket-spring, nem-hybrid-foam"
          }
        },
        {
          "type": "question",
          "settings": {
            "question": "T√¥i hay b·ªã n√≥ng khi ng·ªß",
            "category": "temperature",
            "recommended_products": "nem-cooling-gel, nem-breathable-spring"
          }
        },
        {
          "type": "question",
          "settings": {
            "question": "N·ªám cho ng∆∞·ªùi cao tu·ªïi",
            "category": "age",
            "recommended_products": "nem-senior-care, nem-joint-support"
          }
        },
        {
          "type": "question",
          "settings": {
            "question": "N·ªám c√≥ b·∫£o h√†nh l√¢u d√†i",
            "category": "budget",
            "recommended_products": "nem-premium-warranty, nem-lifetime-support"
          }
        },
        {
          "type": "question",
          "settings": {
            "question": "N·ªám k√≠ch th∆∞·ªõc 1m6 cho v·ª£ ch·ªìng",
            "category": "size",
            "recommended_products": "nem-couple-1m6, nem-queen-size"
          }
        },
        {
          "type": "question",
          "settings": {
            "question": "N·ªám ch·ªëng khu·∫©n, ch·ªëng b·ª•i m·ªãt",
            "category": "health",
            "recommended_products": "nem-antibacterial, nem-anti-dust"
          }
        },
        {
          "type": "question",
          "settings": {
            "question": "N·ªám ph√π h·ª£p kh√≠ h·∫≠u ·∫©m ∆∞·ªõt",
            "category": "temperature",
            "recommended_products": "nem-moisture-resistant, nem-ventilated"
          }
        },
        {
          "type": "question",
          "settings": {
            "question": "N·ªám cho ng∆∞·ªùi th√≠ch ng·ªß c·ª©ng",
            "category": "sleeping_position",
            "recommended_products": "nem-firm-support, nem-hard-spring"
          }
        },
        {
          "type": "question",
          "settings": {
            "question": "N·ªám c√≥ th·ªÉ g·∫•p g·ªçn, di chuy·ªÉn",
            "category": "material",
            "recommended_products": "nem-foldable, nem-portable"
          }
        },
        {
          "type": "question",
          "settings": {
            "question": "N·ªám cao c·∫•p, sang tr·ªçng",
            "category": "budget",
            "recommended_products": "nem-luxury-collection, nem-premium-series"
          }
        },
        {
          "type": "question",
          "settings": {
            "question": "N·ªám cho ph√≤ng ng·ªß nh·ªè",
            "category": "size",
            "recommended_products": "nem-single-compact, nem-space-saving"
          }
        },
        {
          "type": "question",
          "settings": {
            "question": "N·ªám kh√¥ng g√¢y ti·∫øng ·ªìn khi di chuy·ªÉn",
            "category": "couple",
            "recommended_products": "nem-silent-spring, nem-noise-free"
          }
        },
        {
          "type": "question",
          "settings": {
            "question": "N·ªám thi√™n nhi√™n, th√¢n thi·ªán m√¥i tr∆∞·ªùng",
            "category": "material",
            "recommended_products": "nem-eco-natural, nem-organic-latex"
          }
        },
        {
          "type": "question",
          "settings": {
            "question": "N·ªám c√≥ th·ªÉ d√πng c·∫£ hai m·∫∑t",
            "category": "material",
            "recommended_products": "nem-reversible, nem-dual-comfort"
          }
        }
      ]
    }
  ],
  "disabled_on": {
    "groups": ["footer", "header", "custom.popups"]
  }
}
{% endschema %} 