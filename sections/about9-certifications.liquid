{%- comment -%} Include Design System CSS {%- endcomment -%}
{% render 'about-design-system' %}

<style>
.about-certifications__title {
  font-size: var(--font-size-3xl);
  font-weight: var(--font-weight-bold);
  color: var(--color-text-secondary);
  margin-bottom: var(--space-xl);
  line-height: var(--line-height-tight);
}

.about-certifications__content {
  display: grid;
  grid-template-columns: 659px 1fr;
  gap: var(--gutter-desktop);
  align-items: start;
}

.about-certifications__text {
  font-size: var(--font-size-xl);
  line-height: var(--line-height-relaxed);
  color: var(--color-text-primary);
  text-align: justify;
}

.about-certifications__text p {
  margin-bottom: var(--space-md);
}

.about-certifications__text strong {
  font-weight: var(--font-weight-bold);
}

.about-certifications__button {
  display: inline-block;
  padding: 12px 24px;
  background: var(--color-deep);
  color: white;
  border-radius: 100px;
  text-decoration: none;
  font-size: var(--font-size-xl);
  margin-top: var(--space-md);
  transition: opacity 0.3s;
}

.about-certifications__button:hover {
  opacity: 0.9;
}

.about-certifications__images {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: var(--gutter-desktop);
}

.about-certifications__image-item {
  border-radius: var(--radius-sm);
  padding: var(--space-md);
  text-align: center;
}

.about-certifications__image-placeholder {
  width: 100%;
  height: 312px;
  background: var(--color-background-light);
  display: block;
  margin-bottom: var(--space-md);
}

.about-certifications__image-item img {
  width: 100%;
  height: auto;
  object-fit: contain;
  display: block;
  margin-bottom: var(--space-md);
}

.about-certifications__image-label {
  font-size: var(--font-size-xl);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text-primary);
}

@media (max-width: 749px) {
  .about-certifications {
    padding: 0;
  }
  
  .about-certifications__content {
    grid-template-columns: 1fr;
    gap: 0;
    padding: 0 15px;
  }
  
  .about-certifications__title {
    font-size: 20px;
    font-weight: 700;
    color: #1c2c58;
    line-height: 1.4;
    margin-bottom: 24px;
  }
  
  .about-certifications__text {
    font-size: 14px;
    line-height: 1.4;
    color: #000;
    text-align: justify;
    margin-bottom: 24px;
  }
  
  .about-certifications__text p {
    margin-bottom: 16px;
  }
  
  .about-certifications__button {
    height: 40px;
    padding: 0 24px;
    background: #234085;
    color: white;
    border-radius: 30px;
    font-size: 14px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    margin-top: 0;
  }
  
  .about-certifications__images {
    display: flex;
    overflow-x: auto;
    overflow-y: hidden;
    scroll-snap-type: x mandatory;
    gap: 20px;
    margin-top: 24px;
    padding-bottom: 20px;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    position: relative;
  }
  
  .about-certifications__images::-webkit-scrollbar {
    display: none;
  }
  
  .about-certifications__image-item {
    flex: 0 0 calc(100% - 30px);
    scroll-snap-align: start;
    padding: 0;
    min-width: 0;
  }
  
  .about-certifications__image-item img {
    margin-bottom: 12px;
    width: 100%;
    height: auto;
  }
  
  .about-certifications__image-label {
    font-size: 14px;
    font-weight: 600;
    color: #000;
  }
  
  /* Navigation buttons */
  .about-certifications__nav {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 4px;
    padding: 20px 15px 0;
    position: relative;
  }
  
  .about-certifications__nav-dot {
    width: 6px;
    height: 6px;
    border-radius: 100px;
    background: #dbe8ff;
    cursor: pointer;
    transition: background 0.3s;
  }
  
  .about-certifications__nav-dot.active {
    background: #1c2c58;
  }
  
  .about-certifications__nav-button {
    width: 28px;
    height: 28px;
    border-radius: 100px;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    position: absolute;
    padding: 0;
  }
  
  .about-certifications__nav-button--prev {
    left: 276px;
    background: white;
  }
  
  .about-certifications__nav-button--next {
    left: 313px;
    background: #234085;
  }
  
  .about-certifications__nav-button svg {
    width: 14px;
    height: 14px;
  }
}
</style>

<section class="about-section about-certifications page-width">
  {%- if section.settings.title != blank -%}
    <h2 class="about-certifications__title">{{ section.settings.title }}</h2>
  {%- endif -%}
  <div class="about-certifications__content">
    <div class="about-certifications__text">
      {%- if section.settings.text != blank -%}
        {{ section.settings.text }}
      {%- endif -%}
      {%- if section.settings.button_text != blank and section.settings.button_url != blank -%}
        <a href="{{ section.settings.button_url }}" class="about-certifications__button" {% if section.settings.button_new_tab %}target="_blank"{% endif %}>
          {{ section.settings.button_text }}
        </a>
      {%- endif -%}
    </div>
    <div class="about-certifications__images" data-certifications-carousel>
      {%- for block in section.blocks -%}
        <div class="about-certifications__image-item" {{ block.shopify_attributes }}>
          {%- if block.settings.image -%}
            <img 
              src="{{ block.settings.image | img_url: '800x624' }}" 
              alt="{{ block.settings.image.alt | default: block.settings.label }}"
              loading="lazy"
            >
          {%- else -%}
            <div class="about-certifications__image-placeholder"></div>
          {%- endif -%}
          {%- if block.settings.label != blank -%}
            <p class="about-certifications__image-label">{{ block.settings.label }}</p>
          {%- endif -%}
        </div>
      {%- endfor -%}
    </div>
    {%- if section.blocks.size > 1 -%}
      <div class="about-certifications__nav">
        {%- for block in section.blocks -%}
          <div class="about-certifications__nav-dot {% if forloop.first %}active{% endif %}" data-index="{{ forloop.index0 }}"></div>
        {%- endfor -%}
        <button class="about-certifications__nav-button about-certifications__nav-button--prev" data-prev>
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none">
            <path d="M8.5 10.5L5.5 7L8.5 3.5" stroke="#234085" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <button class="about-certifications__nav-button about-certifications__nav-button--next" data-next>
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14" fill="none">
            <path d="M5.5 3.5L8.5 7L5.5 10.5" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    {%- endif -%}
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const carousel = document.querySelector('[data-certifications-carousel]');
  if (!carousel) return;
  
  const prevBtn = document.querySelector('[data-prev]');
  const nextBtn = document.querySelector('[data-next]');
  const dots = document.querySelectorAll('.about-certifications__nav-dot');
  
  if (!prevBtn || !nextBtn || dots.length === 0) return;
  
  let currentIndex = 0;
  const items = carousel.querySelectorAll('.about-certifications__image-item');
  const totalItems = items.length;
  
  function updateCarousel() {
    const itemWidth = items[0].offsetWidth + 20; // width + gap
    carousel.scrollTo({
      left: currentIndex * itemWidth,
      behavior: 'smooth'
    });
    
    dots.forEach((dot, index) => {
      dot.classList.toggle('active', index === currentIndex);
    });
  }
  
  prevBtn.addEventListener('click', () => {
    currentIndex = (currentIndex - 1 + totalItems) % totalItems;
    updateCarousel();
  });
  
  nextBtn.addEventListener('click', () => {
    currentIndex = (currentIndex + 1) % totalItems;
    updateCarousel();
  });
  
  dots.forEach((dot, index) => {
    dot.addEventListener('click', () => {
      currentIndex = index;
      updateCarousel();
    });
  });
  
  // Update on scroll
  carousel.addEventListener('scroll', () => {
    const itemWidth = items[0].offsetWidth + 20;
    const newIndex = Math.round(carousel.scrollLeft / itemWidth);
    if (newIndex !== currentIndex && newIndex >= 0 && newIndex < totalItems) {
      currentIndex = newIndex;
      dots.forEach((dot, index) => {
        dot.classList.toggle('active', index === currentIndex);
      });
    }
  });
});
</script>

{% schema %}
{
  "name": "About9 - Certifications",
  "tag": "section",
  "class": "about9-certifications-section",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Chất lượng sản phẩm vượt trội"
    },
    {
      "type": "richtext",
      "id": "text",
      "label": "Text",
      "default": "<p>Ru9 tự hào là <strong>thương hiệu tiên phong tại Việt Nam đạt chứng nhận CertiPUR-US® cho foam nệm</strong>, khẳng định độ an toàn, thân thiện với môi trường và tuân thủ các tiêu chuẩn khắt khe về thành phần, quy trình sản xuất và khí thải.</p><p>Ru9 sử dụng vải đạt <strong>STANDARD 100 by OEKO-TEX®</strong>, bảo đảm không chứa chất độc hại, an toàn cho sức khỏe và thân thiện với môi trường.</p>"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button Text",
      "default": "Xem chi tiết"
    },
    {
      "type": "url",
      "id": "button_url",
      "label": "Button URL"
    },
    {
      "type": "checkbox",
      "id": "button_new_tab",
      "label": "Open in New Tab",
      "default": true
    }
  ],
  "blocks": [
    {
      "type": "certification",
      "name": "Certification",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Certification Image",
          "info": "Recommended size: 400x312px"
        },
        {
          "type": "text",
          "id": "label",
          "label": "Label",
          "default": "CertiPUR-US®"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "About9 - Certifications",
      "blocks": [
        {
          "type": "certification",
          "settings": {
            "label": "CertiPUR-US®"
          }
        },
        {
          "type": "certification",
          "settings": {
            "label": "OEKO-TEX®"
          }
        }
      ]
    }
  ]
}
{% endschema %}

<script>
document.addEventListener('DOMContentLoaded', function() {
  const carousel = document.querySelector('[data-certifications-carousel]');
  if (!carousel) return;
  
  const prevBtn = document.querySelector('[data-prev]');
  const nextBtn = document.querySelector('[data-next]');
  const dots = document.querySelectorAll('.about-certifications__nav-dot');
  
  if (!prevBtn || !nextBtn || dots.length === 0) return;
  
  let currentIndex = 0;
  const items = carousel.querySelectorAll('.about-certifications__image-item');
  const totalItems = items.length;
  
  function updateCarousel() {
    const itemWidth = items[0].offsetWidth + 20; // width + gap
    carousel.scrollTo({
      left: currentIndex * itemWidth,
      behavior: 'smooth'
    });
    
    dots.forEach((dot, index) => {
      dot.classList.toggle('active', index === currentIndex);
    });
  }
  
  prevBtn.addEventListener('click', () => {
    currentIndex = (currentIndex - 1 + totalItems) % totalItems;
    updateCarousel();
  });
  
  nextBtn.addEventListener('click', () => {
    currentIndex = (currentIndex + 1) % totalItems;
    updateCarousel();
  });
  
  dots.forEach((dot, index) => {
    dot.addEventListener('click', () => {
      currentIndex = index;
      updateCarousel();
    });
  });
  
  // Update on scroll
  carousel.addEventListener('scroll', () => {
    const itemWidth = items[0].offsetWidth + 20;
    const newIndex = Math.round(carousel.scrollLeft / itemWidth);
    if (newIndex !== currentIndex) {
      currentIndex = newIndex;
      dots.forEach((dot, index) => {
        dot.classList.toggle('active', index === currentIndex);
      });
    }
  });
});
</script>

